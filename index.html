<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="chenleno&#39;s">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="chenleno&#39;s">
<meta property="article:author" content="chenleno">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>chenleno's</title>
  








<meta name="generator" content="Hexo 4.2.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">chenleno's</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">用脑用心</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2023/07/24/Rust%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="chenleno">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="chenleno's">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2023/07/24/Rust%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" itemprop="url">Rust学习笔记</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2023-07-24T18:52:35+08:00">
                2023-07-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Rust学习笔记"><a href="#Rust学习笔记" class="headerlink" title="Rust学习笔记"></a>Rust学习笔记</h1><p>学习资料来源：<a href="https://course.rs/about-book.html" target="_blank" rel="noopener">Rust语言圣经(Rust Course)</a></p>
<h2 id="基础入门"><a href="#基础入门" class="headerlink" title="基础入门"></a>基础入门</h2><h3 id="基本类型"><a href="#基本类型" class="headerlink" title="基本类型"></a>基本类型</h3><ul>
<li>数值类型</li>
<li>字符，布尔，单元类型</li>
</ul>
<p>基本类型的创建都是创建在栈中</p>
<h4 id="语句与表达式"><a href="#语句与表达式" class="headerlink" title="语句与表达式"></a>语句与表达式</h4><p>有<code>;</code>的是语句，没有的是表达式。<br><code>;</code>很重要!!就是有没有返回值的重要!!!</p>
<p>该语句块返回一个返回值<code>y + 3</code>, Rust中返回值不需要<code>return</code>(也可以用<code>return</code>)</p>
<figure class="highlight rs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="keyword">let</span> y = <span class="number">1</span>;</span><br><span class="line">  y + <span class="number">3</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Rust中的三元</p>
<figure class="highlight rs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> y = <span class="keyword">if</span> x % <span class="number">2</span> == <span class="number">1</span> &#123;</span><br><span class="line">        <span class="string">"odd"</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="string">"even"</span></span><br><span class="line">    &#125;;</span><br></pre></td></tr></table></figure>

<h4 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h4><p>函数参数必须标注类型</p>
<p>函数没有返回值时，默认返回空元组<code>()</code></p>
<p><code>fn a() -&gt; ! {}</code>表示函数永不返回(发散函数)</p>
<h3 id="所有权和借用"><a href="#所有权和借用" class="headerlink" title="所有权和借用"></a>所有权和借用</h3><blockquote>
<p>释放内存的三种机制：</p>
</blockquote>
<ul>
<li>垃圾回收机制(GC)，在程序运行时不断寻找不再使用的内存，典型代表：Java、Go</li>
<li>手动管理内存的分配和释放, 在程序中，通过函数调用的方式来申请和释放内存，典型代表：C++</li>
<li>通过所有权来管理内存，编译器在编译时会根据一系列规则进行检查 Rust</li>
</ul>
<p>栈：先进后出，栈中的所有数据都必须占用已知且固定大小的内存空间，假设数据大小是未知的，那么在取出数据时，你将无法取到你想要的数据</p>
<p>堆：先进先出，当向堆上放入数据时，需要请求一定大小的内存空间。操作系统在堆的某处找到一块足够大的空位，把它标记为已使用，并返回一个表示该位置地址的指针, 该过程被称为在堆上分配内存。接着，该指针会被推入栈中，因为指针的大小是已知且固定的，在后续使用过程中，你将通过栈中的指针，来获取数据在堆上的实际内存位置，进而访问该数据</p>
<h4 id="所有权"><a href="#所有权" class="headerlink" title="所有权"></a>所有权</h4><ul>
<li>Rust 中每一个值都被一个变量所拥有，该变量被称为值的所有者</li>
<li>一个值同时只能被一个变量所拥有，或者说一个值只能拥有一个所有者</li>
<li>当所有者(变量)离开作用域范围时，这个值将被丢弃(drop)</li>
</ul>
<p><code>String</code>存储在堆上<br><code>String::from</code>中 <code>::</code>是调用操作符，表示调用<code>String</code>中的<code>from</code>方法。（暂且理解成<code>String.from</code>）</p>
<p>转移所有权</p>
<figure class="highlight rs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> s1 = <span class="built_in">String</span>::from(<span class="string">"hello"</span>);</span><br><span class="line"><span class="keyword">let</span> s2 = s1;</span><br></pre></td></tr></table></figure>

<p>当 s1 赋予 s2 后，Rust 认为 s1 不再有效，因此也无需在 s1 离开作用域后 drop 任何东西，这就是把所有权从 s1 转移给了 s2，s1 在被赋予 s2 后就马上失效了。此时如果尝试访问s1，会报错.</p>
<p>上面的例子可以解读为 s1 被<strong>移动</strong>到了 s2 中</p>
<p>Rust 称呼 <code>let a = b</code> 为变量绑定</p>
<p>克隆（深拷贝）</p>
<figure class="highlight rs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> s1 = <span class="built_in">String</span>::from(<span class="string">"hello"</span>);</span><br><span class="line"><span class="keyword">let</span> s2 = s1.clone()</span><br></pre></td></tr></table></figure>

<p>拷贝(浅拷贝)</p>
<figure class="highlight rs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> x = <span class="number">5</span>;</span><br><span class="line"><span class="keyword">let</span> y = x;</span><br></pre></td></tr></table></figure>
<p>任何基本类型的组合可以 Copy ，不需要分配内存或某种形式资源的类型是可以 Copy 的</p>
<ul>
<li>所有整数类型，比如 u32</li>
<li>布尔类型，bool，它的值是 true 和 false</li>
<li>所有浮点数类型，比如 f64</li>
<li>字符类型，char</li>
<li>元组，当且仅当其包含的类型也都是 Copy 的时候。比如，(i32, i32) 是 Copy 的，但 (i32, String) 就不是</li>
<li>不可变引用 &amp;T ，例如转移所有权中的最后一个例子，但是注意: 可变引用 &amp;mut T 是不可以 Copy的</li>
</ul>
<h4 id="引用与借用"><a href="#引用与借用" class="headerlink" title="引用与借用"></a>引用与借用</h4><p>获取<strong>变量的引用</strong>，称之为<strong>借用</strong>(borrowing)</p>
<p>引用与解引用</p>
<figure class="highlight rs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> x = <span class="number">5</span>;</span><br><span class="line">    <span class="keyword">let</span> y = &amp;x;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="number">5</span>, x);</span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="number">5</span>, *y);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>&amp;</code>符号即是引用，它们允许你使用值，但是不获取所有权</p>
<p><code>let y = &amp;x</code> 为 y对x的引用，比较时不能将整数类型与引用类型比较，因此必须对y解引用<code>*y</code></p>
<p>可变引用</p>
<p>同一作用域，特定数据<strong>只能有一个</strong>可变引用：</p>
<figure class="highlight rs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut</span> s = <span class="built_in">String</span>::from(<span class="string">"hello"</span>);</span><br><span class="line"></span><br><span class="line">    change(&amp;<span class="keyword">mut</span> s);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">change</span></span>(some_string: &amp;<span class="keyword">mut</span> <span class="built_in">String</span>) &#123;</span><br><span class="line">    some_string.push_str(<span class="string">", world"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这种限制的好处就是使 Rust 在编译期就避免数据竞争，数据竞争可由以下行为造成：</p>
<ul>
<li>两个或更多的指针同时访问同一数据</li>
<li>至少有一个指针被用来写入数据</li>
<li>没有同步数据访问的机制</li>
</ul>
<p>可变引用与不可变引用不能同时存在</p>
<p>引用的作用域 s 从创建开始，一直持续到它最后一次使用的地方，这个跟变量的作用域有所不同，变量的作用域从创建持续到某一个花括号 <code>}</code></p>
<p>总的来说，借用规则如下：</p>
<ul>
<li>同一时刻，你只能拥有要么一个可变引用, 要么任意多个不可变引用</li>
<li>引用必须总是有效的</li>
</ul>
<h3 id="复合类型"><a href="#复合类型" class="headerlink" title="复合类型"></a>复合类型</h3><h4 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h4><p>切片: <code>[开始索引..终止索引]</code></p>
<p>切片的单位是字节, 因此中午字符串不能按字数切片</p>
<figure class="highlight rs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> s = <span class="built_in">String</span>::from(<span class="string">"hello world"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> hello = &amp;s[<span class="number">0</span>..<span class="number">5</span>];</span><br><span class="line"><span class="keyword">let</span> world = &amp;s[<span class="number">6</span>..<span class="number">11</span>];</span><br></pre></td></tr></table></figure>
<p>字符串切片是非常危险的操作，因为切片的索引是通过字节来进行，但是字符串又是 UTF-8 编码，因此你无法保证索引的字节刚好落在字符的边界上</p>
<p>操作字符串</p>
<ul>
<li>追加: 在字符串尾部可以使用 <code>push()</code> 方法追加字符 char，也可以使用 <code>push_str()</code> 方法追加字符串字面量<br>这两个方法都是在原有的字符串上追加，并不会返回新的字符串。由于字符串追加操作要修改原来的字符串，则该字符串必须是可变的，即字符串变量必须由 mut 关键字修饰</li>
<li>插入: 使用 <code>insert()</code> 方法插入单个字符 char，也可以使用 <code>insert_str()</code> 方法插入字符串字面量<br>第一个参数是字符（串）插入位置的索引，第二个参数是要插入的字符（串），索引从 0 开始计数，如果越界则会发生错误。由于字符串插入操作要修改原来的字符串，则该字符串必须是可变的，即字符串变量必须由 mut 关键字修饰</li>
<li>替换：<ul>
<li><code>replace()</code> 该方法可适用于 String 和 &amp;str 类型。接收两个参数，第一个参数是要被替换的字符串，第二个参数是新的字符串。该方法会替换所有匹配到的字符串。该方法是返回一个新的字符串，而不是操作原来的字符串</li>
<li><code>replacen()</code> 该方法可适用于 String 和 &amp;str 类型。 接收三个参数，前两个参数与 replace() 方法一样，第三个参数则表示替换的个数。该方法是返回一个新的字符串，而不是操作原来的字符串</li>
<li><code>replace_range()</code> 该方法仅适用于 String 类型。接收两个参数，第一个参数是要替换字符串的范围（Range），第二个参数是新的字符串。该方法是直接操作原来的字符串，不会返回新的字符串。该方法需要使用 mut 关键字修饰。</li>
</ul>
</li>
<li>删除：<ul>
<li><code>pop()</code> 删除并返回字符串的最后一个字符, 该方法是直接操作原来的字符串,但是存在返回值，其返回值是一个 Option 类型，如果字符串为空，则返回 None</li>
<li><code>remove()</code> 删除并返回字符串中指定位置的字符, 该方法是直接操作原来的字符串。但是存在返回值，其返回值是删除位置的字符串，只接收一个参数，表示该字符起始索引位置。remove() 方法是按照字节来处理字符串的，如果参数所给的位置不是合法的字符边界，则会发生错误</li>
<li><code>truncate()</code> 删除字符串中从指定位置开始到结尾的全部字符, 该方法是直接操作原来的字符串。无返回值。该方法 truncate() 方法是按照字节来处理字符串的，如果参数所给的位置不是合法的字符边界，则会发生错误。</li>
<li><code>clear()</code> 清空字符串,该方法是直接操作原来的字符串。调用后，删除字符串中的所有字符，相当于 truncate() 方法参数为 0 的时候。</li>
</ul>
</li>
<li>连接：使用 + 或者 += 连接字符串（还有一个<code>format</code>方法）<br>使用 + 或者 += 连接字符串，要求右边的参数必须为字符串的切片引用（Slice）类型。其实当调用 + 的操作符时，相当于调用了 std::string 标准库中的 add() 方法，这里 add() 方法的第二个参数是一个引用的类型。因此我们在使用 +， 必须传递切片引用类型。不能直接传递 String 类型。+ 是返回一个新的字符串，所以变量声明可以不需要 mut 关键字修饰</li>
</ul>
<h4 id="元组"><a href="#元组" class="headerlink" title="元组"></a>元组</h4><p>元组可以嵌套元组</p>
<figure class="highlight rs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> (x, y, z) = (<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>);</span><br><span class="line"><span class="keyword">let</span> uu = (<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>);</span><br><span class="line"><span class="keyword">let</span> x = uu.<span class="number">0</span>;</span><br><span class="line"><span class="keyword">let</span> y = uu.<span class="number">1</span>;</span><br><span class="line"><span class="keyword">let</span> z = uu.<span class="number">2</span>;</span><br></pre></td></tr></table></figure>

<h4 id="结构体"><a href="#结构体" class="headerlink" title="结构体"></a>结构体</h4><p>关键字 <code>struct</code></p>
<figure class="highlight rs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">User</span></span> &#123;</span><br><span class="line">  username: <span class="built_in">String</span>,</span><br><span class="line">  email: <span class="built_in">String</span>,</span><br><span class="line">  age: <span class="built_in">u32</span>,</span><br><span class="line">  active: <span class="built_in">bool</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="keyword">mut</span> user1 = User &#123;</span><br><span class="line">  email: <span class="built_in">String</span>::from(<span class="string">"你好"</span>),</span><br><span class="line">  username: <span class="built_in">String</span>::from(<span class="string">"hello"</span>),</span><br><span class="line">  age: <span class="number">18</span>,</span><br><span class="line">  active: <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> active = user1.active</span><br></pre></td></tr></table></figure>

<p>结构体更新语法: <code>..</code> 语法表明凡是我们没有显式声明的字段，全部从 user1 中自动获取。需要注意的是 ..user1 必须在结构体的尾部使用</p>
<figure class="highlight rs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> user2 = User &#123;</span><br><span class="line">    email: <span class="built_in">String</span>::from(<span class="string">"another@example.com"</span>),</span><br><span class="line">    ..user1</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">println!</span>(<span class="string">"user1 : &#123;&#125;"</span>, user1) <span class="comment">// 报错</span></span><br><span class="line"><span class="built_in">println!</span>(<span class="string">"user1.email, &#123;&#125;"</span>, user1.email) <span class="comment">// 正常</span></span><br></pre></td></tr></table></figure>

<p>元组结构体</p>
<figure class="highlight rs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Position</span></span>(<span class="built_in">i32</span>, <span class="built_in">i32</span>, <span class="built_in">i32</span>)</span><br><span class="line"><span class="keyword">let</span> position1 = Position(<span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>)</span><br><span class="line"><span class="keyword">let</span> Position(x, y ,z) = position1</span><br></pre></td></tr></table></figure>

<p>单元结构体</p>
<p>定义一个类型，但是不关心该类型的内容, 只关心它的行为时，就可以使用 单元结构体</p>
<figure class="highlight rs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">AlwaysEqual</span></span>;</span><br><span class="line"><span class="keyword">let</span> subject = AlwaysEqual;</span><br><span class="line"><span class="comment">// 我们不关心 AlwaysEqual 的字段数据，只关心它的行为，因此将它声明为单元结构体，然后再为它实现某个特征</span></span><br><span class="line"><span class="keyword">impl</span> SomeTrait <span class="keyword">for</span> AlwaysEqual &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出结构体详情<code>#[derive(Debug)]</code></p>
<figure class="highlight rs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[derive(Debug)]</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h4 id="枚举"><a href="#枚举" class="headerlink" title="枚举"></a>枚举</h4><p>通过<code>enum</code>定义枚举</p>
<figure class="highlight rs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">Country</span></span> &#123;</span><br><span class="line">  China(<span class="string">"China"</span>),</span><br><span class="line">  America(<span class="string">"America"</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> country = Country::China</span><br></pre></td></tr></table></figure>
<h4 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h4><p>分为数组<code>array</code>和动态数组<code>Vector</code><br><code>array</code>长度固定，分配在栈上, 元素类型要统一，长度要固定<br><code>Vector</code>长度可变，分配在堆上</p>
<p>类似字符串的<code>&amp;str</code>和<code>String</code></p>
<figure class="highlight rs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// [类型; 长度]</span></span><br><span class="line"><span class="keyword">let</span> a: [<span class="built_in">i32</span>; <span class="number">5</span>] = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]</span><br><span class="line"><span class="keyword">let</span> a = [<span class="number">3</span>; <span class="number">5</span>]</span><br><span class="line"><span class="comment">// std::array::from_f</span></span><br><span class="line"><span class="keyword">let</span> array: [<span class="built_in">String</span>; <span class="number">8</span>] = std::array::from_fn(|i| <span class="built_in">String</span>::from(<span class="string">"rust is good!"</span>));</span><br></pre></td></tr></table></figure>
<h3 id="流程控制"><a href="#流程控制" class="headerlink" title="流程控制"></a>流程控制</h3><p>if语句块可以充当表达式, 要保证每个分支返回的类型一样</p>
<figure class="highlight rs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> num = <span class="keyword">if</span> <span class="literal">true</span> &#123;</span><br><span class="line">  <span class="number">5</span></span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="number">6</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>循环<code>for</code>、<code>while</code> 和 <code>loop</code></p>
<figure class="highlight rs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> 元素 <span class="keyword">in</span> 集合 &#123;</span><br><span class="line">  <span class="comment">// 使用元素干一些你懂我不懂的事情</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 在循环中，修改该元素</span></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> &amp;<span class="keyword">mut</span> collection &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当有多层循环时，你可以使用 continue 或 break 来控制外层的循环。要实现这一点，外部的循环必须拥有一个标签 ‘label, 然后在 break 或 continue 时指定该标签</p>
<figure class="highlight rs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut</span> count = <span class="number">0</span>;</span><br><span class="line">    <span class="symbol">'outer</span>: <span class="keyword">loop</span> &#123;</span><br><span class="line">        <span class="symbol">'inner1</span>: <span class="keyword">loop</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> count &gt;= <span class="number">20</span> &#123;</span><br><span class="line">                <span class="comment">// 这只会跳出 inner1 循环</span></span><br><span class="line">                <span class="keyword">break</span> <span class="symbol">'inner1</span>; <span class="comment">// 这里使用 `break` 也是一样的</span></span><br><span class="line">            &#125;</span><br><span class="line">            count += <span class="number">2</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        count += <span class="number">5</span>;</span><br><span class="line">        <span class="symbol">'inner2</span>: <span class="keyword">loop</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> count &gt;= <span class="number">30</span> &#123;</span><br><span class="line">                <span class="keyword">break</span> <span class="symbol">'outer</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">continue</span> <span class="symbol">'outer</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">assert!</span>(count == <span class="number">30</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="模式匹配"><a href="#模式匹配" class="headerlink" title="模式匹配"></a>模式匹配</h3><p>match 匹配</p>
<figure class="highlight rs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">match</span> target &#123;</span><br><span class="line">    模式<span class="number">1</span> =&gt; 表达式<span class="number">1</span>,</span><br><span class="line">    模式<span class="number">2</span> =&gt; &#123;</span><br><span class="line">        语句<span class="number">1</span>;</span><br><span class="line">        语句<span class="number">2</span>;</span><br><span class="line">        表达式<span class="number">2</span></span><br><span class="line">    &#125;,</span><br><span class="line">    _ =&gt; 表达式<span class="number">3</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>穷尽匹配，非重点匹配项可用 <code>_</code> 替代(相当于switch…case…中的 default)</p>
<p>if…let…</p>
<figure class="highlight rs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> v = <span class="literal">Some</span>(<span class="number">3u8</span>);</span><br><span class="line"><span class="keyword">match</span> v &#123;</span><br><span class="line">    <span class="literal">Some</span>(<span class="number">3</span>) =&gt; <span class="built_in">println!</span>(<span class="string">"three"</span>),</span><br><span class="line">    _ =&gt; (),</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 等价于</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> <span class="literal">Some</span>(<span class="number">3</span>) = v &#123;</span><br><span class="line">  <span class="built_in">println!</span>(<span class="string">"three"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当你只要匹配一个条件，且忽略其他条件时就用 if let ，否则都用 match。</p>
<p>matches!宏</p>
<figure class="highlight rs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// matches!宏 返回 true|false</span></span><br><span class="line"><span class="keyword">let</span> foo = <span class="string">'f'</span>;</span><br><span class="line"><span class="built_in">assert!</span>(matches!(foo, <span class="string">'A'</span>..=<span class="string">'Z'</span> | <span class="string">'a'</span>..=<span class="string">'z'</span>));</span><br></pre></td></tr></table></figure>

<h3 id="方法method"><a href="#方法method" class="headerlink" title="方法method"></a>方法method</h3><p>使用<code>impl</code>定义方法</p>
<p>rust方法和其他语言的区别</p>
<figure class="highlight rs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Circle</span></span> &#123;</span><br><span class="line">  x: <span class="built_in">i32</span>,</span><br><span class="line">  y: <span class="built_in">i32</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> Circle &#123;</span><br><span class="line">  <span class="comment">// new是Circle的关联函数，因为它的第一个参数不是self，且new并不是关键字</span></span><br><span class="line">  <span class="comment">// 这种方法往往用于初始化当前结构体的实例</span></span><br><span class="line">  <span class="function"><span class="keyword">fn</span> <span class="title">new</span></span>(x: <span class="built_in">i32</span>, y:<span class="built_in">i32</span>) -&gt; <span class="keyword">Self</span> &#123;</span><br><span class="line">    Circle &#123;</span><br><span class="line">      x: x,</span><br><span class="line">      y: y</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// Circle的方法，&amp;self表示借用当前的Circle结构体</span></span><br><span class="line">  <span class="function"><span class="keyword">fn</span> <span class="title">area</span></span>(&amp;<span class="keyword">self</span>) -&gt; <span class="built_in">f64</span> &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://pica.zhimg.com/80/v2-0d848e960f3279999eab4b1317f6538e_1440w.png" alt="方法"></p>
<p>关联函数<br>因为是函数，所以不能用 <code>.</code> 的方式来调用，我们需要用 <code>::</code> 来调用，例如 <code>let sq = Rectangle::new(3, 3);</code>。这个方法位于结构体的命名空间中：<code>::</code> 语法用于关联函数和模块创建的命名空间</p>
<h3 id="泛型和特征"><a href="#泛型和特征" class="headerlink" title="泛型和特征"></a>泛型和特征</h3><h4 id="泛型"><a href="#泛型" class="headerlink" title="泛型"></a>泛型</h4><ul>
<li>提前声明，跟泛型函数定义类似，首先我们在使用泛型参数之前必需要进行声明 <code>Point&lt;T&gt;</code>，接着就可以在结构体的字段类型中使用 T 来替代具体的类型</li>
<li>x 和 y 是相同的类型<figure class="highlight rs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Point</span></span>&lt;T&gt; &#123;</span><br><span class="line">  x: T,</span><br><span class="line">  y: T</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>方法中使用泛型</p>
<p>使用泛型参数前，依然需要提前声明：impl<T>，只有提前声明了，我们才能在Point<T>中使用它，这样 Rust 就知道 Point 的尖括号中的类型是泛型而不是具体类型。需要注意的是，这里的 Point<T> 不再是泛型声明，而是一个完整的结构体类型，因为我们定义的结构体就是 Point<T> 而不再是 Point<br><code>impl&lt;T&gt;</code></p>
<figure class="highlight rs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">impl</span>&lt;T&gt; Point&lt;T&gt; &#123;</span><br><span class="line">  <span class="function"><span class="keyword">fn</span> <span class="title">x</span></span>(&amp;<span class="keyword">self</span>) -&gt; &amp;T &#123;</span><br><span class="line">    &amp;<span class="keyword">self</span>.x</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>const泛型: 针对值的泛型</p>
<figure class="highlight rs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">display_array</span></span>&lt;T: std::fmt::<span class="built_in">Debug</span>, <span class="keyword">const</span> N: <span class="built_in">usize</span>&gt;(arr: [T; N]) &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">"&#123;:?&#125;"</span>, arr);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>泛型的性能：Rust 通过在编译时进行泛型代码的 单态化(monomorphization)来保证效率。单态化是一个通过填充编译时使用的具体类型，将通用代码转换为特定代码的过程。<br>即根据输入生成对应所有输入类型的处理函数，因此没有运行时开销，牺牲打包时间和容量</p>
<p>泛型特征<br><code>&lt;T: std::ops::Add&lt;Output = T&gt;&gt;</code> add特征</p>
<h3 id="生命周期"><a href="#生命周期" class="headerlink" title="生命周期"></a><strong>生命周期</strong></h3><p>标记的生命周期只是为了取悦编译器，让编译器不要难为我们<br>生命周期语法以<code>&#39;</code>开头</p>
<figure class="highlight rs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&amp;<span class="built_in">i32</span></span><br><span class="line">&amp;<span class="symbol">'a</span> <span class="built_in">i32</span></span><br><span class="line">&amp;<span class="symbol">'a</span> <span class="keyword">mut</span> <span class="built_in">i32</span></span><br></pre></td></tr></table></figure>

<p>三条消除规则</p>
<ul>
<li>每一个引用参数都会获得独自的生命周期</li>
<li>若只有一个输入生命周期(函数参数中只有一个引用类型)，那么该生命周期会被赋给所有的输出生命周期，也就是所有返回值的生命周期都等于该输入生命周期</li>
<li>若存在多个输入生命周期，且其中一个是 &amp;self 或 &amp;mut self，则 &amp;self 的生命周期被赋给所有的输出生命周期</li>
</ul>
<p>静态生命周期<code>&#39;static</code>, 拥有该生命周期的引用可以和整个程序活得一样久。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2023/07/14/%E5%89%8D%E7%AB%AF%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E4%B8%8E%E6%80%9D%E8%80%83/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="chenleno">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="chenleno's">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2023/07/14/%E5%89%8D%E7%AB%AF%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E4%B8%8E%E6%80%9D%E8%80%83/" itemprop="url">前端项目架构设计与思考</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2023-07-14T17:55:09+08:00">
                2023-07-14
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="前端项目架构设计与思考"><a href="#前端项目架构设计与思考" class="headerlink" title="前端项目架构设计与思考"></a>前端项目架构设计与思考</h1><h2 id="项目需求分析"><a href="#项目需求分析" class="headerlink" title="项目需求分析"></a>项目需求分析</h2><h3 id="网站还是系统"><a href="#网站还是系统" class="headerlink" title="网站还是系统"></a>网站还是系统</h3><h3 id="静态网站通用落地范式"><a href="#静态网站通用落地范式" class="headerlink" title="静态网站通用落地范式"></a>静态网站通用落地范式</h3><h2 id="系统级前端项目设计"><a href="#系统级前端项目设计" class="headerlink" title="系统级前端项目设计"></a>系统级前端项目设计</h2><h3 id="框架选型"><a href="#框架选型" class="headerlink" title="框架选型"></a>框架选型</h3><ul>
<li>基础框架(React / VUE)及相关全家桶</li>
<li>TS</li>
<li>UMI, </li>
</ul>
<h3 id="项目模块设计"><a href="#项目模块设计" class="headerlink" title="项目模块设计"></a>项目模块设计</h3><ul>
<li>Router</li>
<li>Page/Module</li>
<li>Components<ul>
<li>common</li>
</ul>
</li>
<li>Model<ul>
<li>global</li>
</ul>
</li>
<li>Service<ul>
<li>http<ul>
<li>API</li>
</ul>
</li>
<li>socketIO</li>
<li>event</li>
</ul>
</li>
<li>Utils<ul>
<li>common</li>
</ul>
</li>
<li>Constants</li>
<li>app</li>
</ul>
<h3 id="项目工程化构建"><a href="#项目工程化构建" class="headerlink" title="项目工程化构建"></a>项目工程化构建</h3><ul>
<li>webpack</li>
<li>rollup</li>
</ul>
<h3 id="项目部署"><a href="#项目部署" class="headerlink" title="项目部署"></a>项目部署</h3>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2023/07/11/nvm%E7%9A%84%E5%AE%89%E8%A3%85%E5%8F%8A%E4%BD%BF%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="chenleno">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="chenleno's">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2023/07/11/nvm%E7%9A%84%E5%AE%89%E8%A3%85%E5%8F%8A%E4%BD%BF%E7%94%A8/" itemprop="url">nvm的安装及使用</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2023-07-11T15:09:06+08:00">
                2023-07-11
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="nvm的安装及使用"><a href="#nvm的安装及使用" class="headerlink" title="nvm的安装及使用"></a>nvm的安装及使用</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>重新拾起吃灰的blog，发现执行<code>hexo d</code>时给了报错</p>
<blockquote>
<p>TypeError [ERR_INVALID_ARG_TYPE]: The “mode” argument must be integer. Received an instance of Object</p>
</blockquote>
<p>本人的hexo版本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">hexo: 4.2.0</span><br><span class="line">hexo-cli: 3.1.0</span><br><span class="line">os: Darwin 17.7.0 darwin x64</span><br><span class="line">node: 16.20.0</span><br></pre></td></tr></table></figure>

<p>查询资料了解到是由于node版本过高导致，需要降级为低版本（13.x.x）才能使用。但是卸载重装这事也太low了，而且保不齐有其他的项目又需要高版本node。想起nvm这个大名鼎鼎的node管理工具，借此机会正好体验一下。</p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>查阅了多方资料，安装过程不尽相同。下面就只以本人的安装过程介绍。（MacOS系统，没有卸载原有的node）<br>首先附上官方文档地址<a href="https://github.com/nvm-sh/nvm/blob/master/README.md" target="_blank" rel="noopener">nvm</a></p>
<p>MacOS下可以通过<code>curl</code>方便地安装nvm,只需要开启终端，输入以下命令即可</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -o- https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;nvm-sh&#x2F;nvm&#x2F;v0.39.3&#x2F;install.sh | bash</span><br></pre></td></tr></table></figure>

<p>届时会出现一个进度说明，耐心等待安装完成即可</p>
<p><a href="https://imgse.com/i/pCWNkND" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2023/07/11/pCWNkND.png" alt="pCWNkND.png"></a></p>
<p>PS: 如果进度说明中各项都为0，只有<code>Time Spent</code>在增加，可能是终端请求资源地址不通，需要配置终端代理（科学上网）</p>
<p>安装完成后，会出现如下所示的说明</p>
<p><a href="https://imgse.com/i/pCWNaD0" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2023/07/11/pCWNaD0.png" alt="pCWNaD0.png"></a></p>
<p>这时候如果你在控制台使用nvm，大概率是不行的，会提示<code>This is not the package you are looking for: please go to http://nvm.sh</code></p>
<p>这是因为nvm命令还未被配置到环境变量中，这时候查看安装完成后的说明，作者已经告诉了我们处理方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 你可以选择关闭终端后重新打开来使用nvm，或者使用以下命令来立即应用</span><br><span class="line">&#x3D;&gt; Close and reopen your terminal to start using nvm or run the following to use it now:</span><br><span class="line"></span><br><span class="line">export NVM_DIR&#x3D;&quot;$HOME&#x2F;.nvm&quot;</span><br><span class="line">[ -s &quot;$NVM_DIR&#x2F;nvm.sh&quot; ] &amp;&amp; \. &quot;$NVM_DIR&#x2F;nvm.sh&quot;  # This loads nvm</span><br><span class="line">[ -s &quot;$NVM_DIR&#x2F;bash_completion&quot; ] &amp;&amp; \. &quot;$NVM_DIR&#x2F;bash_completion&quot;  # This loads nvm bash_completion</span><br></pre></td></tr></table></figure>

<p>这里我们试试命令的方式，终端中输入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export NVM_DIR&#x3D;&quot;$HOME&#x2F;.nvm&quot;</span><br><span class="line">[ -s &quot;$NVM_DIR&#x2F;nvm.sh&quot; ] &amp;&amp; \. &quot;$NVM_DIR&#x2F;nvm.sh&quot;  # This loads nvm</span><br><span class="line">[ -s &quot;$NVM_DIR&#x2F;bash_completion&quot; ] &amp;&amp; \. &quot;$NVM_DIR&#x2F;bash_completion&quot;</span><br></pre></td></tr></table></figure>

<p>之后输入<code>nvm --version</code>，可以发现nvm命令已经可以使用</p>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p>有了nvm我们自然要感受一下他的威力，这里我选择安装当前hexo所需的node版本13.14.0</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nvm i 13.14.0</span><br></pre></td></tr></table></figure>

<p><a href="https://imgse.com/i/pCWU8Z6" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2023/07/11/pCWU8Z6.png" alt="pCWU8Z6.png"></a></p>
<p>可以看到顷刻间nvm就帮我们安装好了所需node版本，并且自动切换到了该版本，接下来试试部署命令<code>hexo d</code>，OK，完成部署！</p>
<p>切换到其他node版本也很简单，首先我们可以输入<code>nvm list</code>查看所有当前已安装的node版本</p>
<p><a href="https://imgse.com/i/pCWaAld" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2023/07/11/pCWaAld.png" alt="pCWaAld.png"></a></p>
<p>切换到其他的node版本(例：v18.16.1)，只需要输入 <code>nvm use 18.16.1</code>即可</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/05/06/%E6%8C%91%E6%88%98%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%92%8C%E7%AE%97%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="chenleno">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="chenleno's">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/05/06/%E6%8C%91%E6%88%98%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%92%8C%E7%AE%97%E6%B3%95/" itemprop="url">挑战数据结构和算法</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-05-06T22:42:27+08:00">
                2020-05-06
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index">
                    <span itemprop="name">基础</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="挑战数据结构和算法"><a href="#挑战数据结构和算法" class="headerlink" title="挑战数据结构和算法"></a>挑战数据结构和算法</h1><h2 id="数据结构篇"><a href="#数据结构篇" class="headerlink" title="数据结构篇"></a>数据结构篇</h2><h3 id="栈"><a href="#栈" class="headerlink" title="栈"></a>栈</h3><p>一种先进后出的数据结构，先进的靠近栈底，后进的靠近栈顶，有点类似弹匣的意思~</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">stack</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">this</span>.items = []</span><br><span class="line">  &#125;</span><br><span class="line">  push(ele) &#123; <span class="comment">// 入栈</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.items.push(ele)</span><br><span class="line">  &#125;</span><br><span class="line">  pop(ele) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.items.pop() <span class="comment">// 出栈</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="队列"><a href="#队列" class="headerlink" title="队列"></a>队列</h3><p>一种先进先出的数据结构，有点类似水管~</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">queue</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">this</span>.items = []</span><br><span class="line">  &#125;</span><br><span class="line">  enqueue(ele) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.items.push(ele)</span><br><span class="line">  &#125;</span><br><span class="line">  dequeue(ele) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.items.shift()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="优先队列"><a href="#优先队列" class="headerlink" title="优先队列"></a>优先队列</h4><p>队列中含有优先级这个概念，有两种实现方式</p>
<ul>
<li>入列时按优先级入列，然后执行默认出列</li>
<li>入列时执行默认入列，然后按优先级出列<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 按优先级入列</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">priorityQueue</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">this</span>.items = []</span><br><span class="line">  &#125;</span><br><span class="line">  priorityEnqueue(ele, priority) &#123;</span><br><span class="line">    <span class="keyword">const</span> priorityEle = &#123; ele, priority &#125;</span><br><span class="line">    <span class="keyword">if</span> (isEmpty) <span class="keyword">return</span> <span class="keyword">this</span>.items.push(priorityEle)</span><br><span class="line">    <span class="keyword">const</span> targetIndex = <span class="keyword">this</span>.items.findIndex(<span class="function"><span class="params">i</span> =&gt;</span> i.priority &lt; priorityEle.priority)</span><br><span class="line">    <span class="keyword">if</span> (targetIndex != <span class="number">-1</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.items.splice(targetIndex, <span class="number">0</span>, priorityEle)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.items.push(priorityEle)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  dequeue() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.items.shift()</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">get</span> isEmpty() &#123;</span><br><span class="line">    <span class="keyword">return</span> !<span class="keyword">this</span>.items.length</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 补充：正常入列，按优先级出列</span></span><br><span class="line">&#123;</span><br><span class="line">  ...,</span><br><span class="line">  enqueue(ele, priority) &#123;</span><br><span class="line">    <span class="keyword">const</span> prorityEle = &#123; ele, priority &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.items.push(prorityEle)</span><br><span class="line">  &#125;</span><br><span class="line">  priorityDequeue(priority) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">this</span>.isEmpty) <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">const</span> targetIndex = <span class="keyword">this</span>.items.findIndex(<span class="function"><span class="params">i</span> =&gt;</span> i.priority === priority) </span><br><span class="line">    <span class="keyword">if</span> (targetIndex != <span class="number">-1</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.items.splice(targetIndex, <span class="number">1</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="循环队列"><a href="#循环队列" class="headerlink" title="循环队列"></a>循环队列</h4>将向量空间想象成一个首尾相接的圆环，存储在其中的队列称为循环队列<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">loopQueue</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(items) &#123;</span><br><span class="line">    <span class="keyword">super</span>(items)</span><br><span class="line">  &#125;</span><br><span class="line">  getIndex(index) &#123;</span><br><span class="line">    <span class="keyword">const</span> length = <span class="keyword">this</span>.items.length</span><br><span class="line">    <span class="keyword">return</span> index &gt; length ? index % length : index</span><br><span class="line">  &#125;</span><br><span class="line">  find(index) &#123;</span><br><span class="line">    <span class="keyword">return</span> !<span class="keyword">this</span>.isEmpty ? <span class="keyword">this</span>.items[<span class="keyword">this</span>.getIndex(index)] : <span class="literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">get</span> isEmpty() &#123;</span><br><span class="line">    <span class="keyword">return</span> !<span class="keyword">this</span>.items.length</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="链表"><a href="#链表" class="headerlink" title="链表"></a>链表</h3>数组很方便，但是从数组开头或者中间插入或移除项，成本比较高，因为其他项都会随着变动<br>链表中每个元素都是单独存储的，元素由一个存储元素本身的节点和一个指向下一个节点的指针构成<br>有点像火车~<br><img src="https://user-gold-cdn.xitu.io/2017/6/26/e748673dbb5df2a93c3ee56b52a67849?imageView2/0/w/1280/h/960/ignore-error/1" alt="链表结构图"><br>模拟实现：<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">node</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(ele) &#123;</span><br><span class="line">    <span class="keyword">this</span>.ele = ele</span><br><span class="line">    <span class="keyword">this</span>.next = <span class="literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">linkedList</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">this</span>.head = <span class="literal">null</span></span><br><span class="line">    <span class="keyword">this</span>.length = <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line">  append(ele) &#123;</span><br><span class="line">    <span class="keyword">const</span> node = <span class="keyword">new</span> node(ele)</span><br><span class="line">    <span class="keyword">let</span> current = <span class="literal">null</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">this</span>.head) &#123;</span><br><span class="line">      <span class="keyword">this</span>.head = node</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      current = <span class="keyword">this</span>.head</span><br><span class="line">      <span class="keyword">while</span>(current.next) &#123;</span><br><span class="line">        current = current.next</span><br><span class="line">      &#125;</span><br><span class="line">      current.next = node</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.length++</span><br><span class="line">  &#125;</span><br><span class="line">  insert(position, ele) &#123;</span><br><span class="line">    <span class="keyword">if</span> (position &gt;= <span class="number">0</span> &amp;&amp; position &lt;= <span class="keyword">this</span>.length) &#123;</span><br><span class="line">      <span class="keyword">const</span> node = <span class="keyword">new</span> node(ele)</span><br><span class="line">      <span class="keyword">let</span> current = <span class="keyword">this</span>.head</span><br><span class="line">      <span class="keyword">let</span> previous = <span class="literal">null</span></span><br><span class="line">      <span class="keyword">let</span> index = <span class="number">0</span></span><br><span class="line">      <span class="keyword">if</span> (position === <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">this</span>.head = node</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">while</span>(index++ &lt; position) &#123;</span><br><span class="line">          previous = current</span><br><span class="line">          current = current.next</span><br><span class="line">        &#125;</span><br><span class="line">        node.next = current</span><br><span class="line">        previsou.next = node</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">this</span>.length++</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">  remove(position) &#123;</span><br><span class="line">    <span class="keyword">if</span> (position &gt; <span class="number">-1</span> &amp;&amp; position &lt; <span class="keyword">this</span>.length) &#123;</span><br><span class="line">      <span class="keyword">const</span> node = <span class="keyword">new</span> node(ele)</span><br><span class="line">      <span class="keyword">let</span> current = <span class="keyword">this</span>.head</span><br><span class="line">      <span class="keyword">let</span> previous = <span class="literal">null</span></span><br><span class="line">      <span class="keyword">let</span> index = <span class="number">0</span></span><br><span class="line">      <span class="keyword">if</span> (position === <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">this</span>.head = current.next</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">while</span>(index++ &lt; position) &#123;</span><br><span class="line">          previous = current</span><br><span class="line">          current = current.next</span><br><span class="line">        &#125;</span><br><span class="line">        previous.next = current.next</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">this</span>.length--</span><br><span class="line">      <span class="keyword">return</span> current.ele</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line">  findIndex(ele) &#123;</span><br><span class="line">    <span class="keyword">let</span> current = <span class="keyword">this</span>.head</span><br><span class="line">    <span class="keyword">let</span> previous = <span class="literal">null</span></span><br><span class="line">    <span class="keyword">let</span> index = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span>(current) &#123;</span><br><span class="line">      <span class="keyword">if</span> (current.ele === ele) &#123;</span><br><span class="line">        <span class="keyword">return</span> index + <span class="number">1</span></span><br><span class="line">      &#125;</span><br><span class="line">      index++</span><br><span class="line">      current = current.next</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">  &#125;</span><br><span class="line">  toString() &#123; <span class="comment">// 链表转字符串</span></span><br><span class="line">    <span class="keyword">let</span> current = <span class="keyword">this</span>.head</span><br><span class="line">    <span class="keyword">let</span> str = <span class="string">''</span></span><br><span class="line">    <span class="keyword">while</span>(current) &#123;</span><br><span class="line">      str += current.ele</span><br><span class="line">      current = current.next</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> str</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="双向链表"><a href="#双向链表" class="headerlink" title="双向链表"></a>双向链表</h4>每个链表元素同时拥有prev和next两个指针，分别指向前一个节点和后一个节点<br><img src="https://user-gold-cdn.xitu.io/2017/6/26/69932d224190c9815ce8ebc9eca51a0e?imageView2/0/w/1280/h/960/ignore-error/1" alt="双向链表图"><br>模拟实现：<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">node</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(ele) &#123;</span><br><span class="line">    <span class="keyword">this</span>.ele = ele</span><br><span class="line">    <span class="keyword">this</span>.prev = <span class="literal">null</span></span><br><span class="line">    <span class="keyword">this</span>.next = <span class="literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">doublyLinkedList</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">this</span>.head = <span class="literal">null</span></span><br><span class="line">    <span class="keyword">this</span>.tail = <span class="literal">null</span></span><br><span class="line">    <span class="keyword">this</span>.length = <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line">  insert(position, ele) &#123;</span><br><span class="line">    <span class="keyword">if</span> (position &gt;=<span class="number">0</span> &amp;&amp; position &lt;= <span class="keyword">this</span>.length) &#123;</span><br><span class="line">    <span class="keyword">const</span> node = <span class="keyword">new</span> node(ele)</span><br><span class="line">    <span class="keyword">let</span> current = <span class="keyword">this</span>.head</span><br><span class="line">    <span class="keyword">let</span> previous = <span class="literal">null</span></span><br><span class="line">    <span class="keyword">let</span> index = <span class="number">0</span></span><br><span class="line">    <span class="keyword">if</span> (position === <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!<span class="keyword">this</span>.head) &#123;</span><br><span class="line">        <span class="keyword">this</span>.head = node</span><br><span class="line">        <span class="keyword">this</span>.tail = node</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        node.next = current</span><br><span class="line">        current.prev = node</span><br><span class="line">        <span class="keyword">this</span>.head = node</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (position === <span class="keyword">this</span>.length) &#123;</span><br><span class="line">      current = <span class="keyword">this</span>.tail</span><br><span class="line">      node.prev = current</span><br><span class="line">      current.next = node</span><br><span class="line">      <span class="keyword">this</span>.tail = node</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">while</span>(index++ &lt; position) &#123;</span><br><span class="line">        previsou = current</span><br><span class="line">        current = current.next</span><br><span class="line">      &#125;</span><br><span class="line">      node.next = current</span><br><span class="line">      node.prev  = previsou</span><br><span class="line">      current.prev = node</span><br><span class="line">      previous.next = node</span><br><span class="line">    &#125;</span><br><span class="line">      <span class="keyword">this</span>.length++</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">  removeAt(position) &#123;</span><br><span class="line">    <span class="keyword">if</span> (position &gt; <span class="number">-1</span> &amp;&amp; position &lt; <span class="keyword">this</span>.length) &#123;</span><br><span class="line">      <span class="keyword">let</span> current = <span class="keyword">this</span>.head</span><br><span class="line">      <span class="keyword">let</span> previous = <span class="literal">null</span></span><br><span class="line">      <span class="keyword">let</span> index = <span class="number">0</span></span><br><span class="line">      <span class="keyword">if</span> (position === <span class="number">0</span>) &#123;</span><br><span class="line">        current = current.next</span><br><span class="line">        <span class="keyword">this</span>.head = current</span><br><span class="line">        current.previsou = <span class="literal">null</span></span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (position === <span class="keyword">this</span>.length - <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">this</span>.tail = <span class="keyword">this</span>.tail.prev</span><br><span class="line">        <span class="keyword">this</span>.tail.next = <span class="literal">null</span></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">while</span>(index++ &lt; position) &#123;</span><br><span class="line">          current = current.next</span><br><span class="line">          previous = current</span><br><span class="line">        &#125;</span><br><span class="line">        previous.next = current.next</span><br><span class="line">        current.next.prev = previous</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">this</span>.length--</span><br><span class="line">      <span class="keyword">return</span> current</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="循环链表"><a href="#循环链表" class="headerlink" title="循环链表"></a>循环链表</h4>链表尾元素的next指向链表首元素<br><img src="https://user-gold-cdn.xitu.io/2017/6/24/6c56193b6d0e1eae9fe946ff55852eb5?imageView2/0/w/1280/h/960/ignore-error/1" alt="循环链表图"><h4 id="双向循环链表"><a href="#双向循环链表" class="headerlink" title="双向循环链表"></a>双向循环链表</h4>双向循环链表的首元素的prev指向尾元素，尾元素的next指向首元素<br><img src="https://user-gold-cdn.xitu.io/2017/6/24/3e24dff8ee385ec854fae09a0a1ed80d?imageView2/0/w/1280/h/960/ignore-error/1" alt="双向循环链表图"></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/05/20/git%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="chenleno">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="chenleno's">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/05/20/git%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B/" itemprop="url">git工作流程</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-05-20T10:31:06+08:00">
                2021-05-20
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%B7%A5%E4%BD%9C%E6%B5%81/" itemprop="url" rel="index">
                    <span itemprop="name">工作流</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="git-工作流程"><a href="#git-工作流程" class="headerlink" title="git 工作流程"></a>git 工作流程</h1><p>基于现有git工作流的补充完善,使其更加贴合目前项目诉求</p>
<h2 id="现有工作流优缺点"><a href="#现有工作流优缺点" class="headerlink" title="现有工作流优缺点"></a>现有工作流优缺点</h2><ul>
<li>优点<ul>
<li>pr审核流程一定程度上降低了bug率，提高了代码质量</li>
<li>各分支分工明确，提高了工作效率</li>
</ul>
</li>
<li>缺点<ul>
<li>pr发起或审核不及时会导致pr过大，增加审核时间成本</li>
<li>feature 分支目前有些冗余，分别有 版本, 功能, 和 个人 开发分支</li>
<li>项目存在封版但不上线的情况，这种情形下，feature分支和dev分支存在共存问题，增加了分支维护成本和复杂度</li>
</ul>
</li>
</ul>
<p>为解决以上问题，现提出新git工作流方案，对现有流程做了一定程度的简化和补充</p>
<h2 id="git-工作流说明"><a href="#git-工作流说明" class="headerlink" title="git 工作流说明"></a>git 工作流说明</h2><h3 id="名词解释"><a href="#名词解释" class="headerlink" title="名词解释"></a>名词解释</h3><ul>
<li>迭代：产品主导开需求宣讲会，研发确认所有功能需求，并给出开始时间和结束时间，即为一期迭代</li>
<li>线上分支：<code>master</code> 分支</li>
<li>稳定分支: <code>dev</code> 分支</li>
<li>版本分支：该期迭代所有需求的最终合并分支，一般以 <code>pc/feature/ + [迭代开始日期]_[版本号]</code>命名，例：<code>pc/feature/210330_v4.4.0</code></li>
<li>功能分支：该期迭代所有需求的具体功能分支，基于版本分支创建，后缀为具体功能名称，例<code>pc/feature/210330_v4.4.0_[功能名称]</code></li>
<li>个人分支：如功能分支需要多人协作开发，则具体开发人员基于功能分支创建个人开发分支，后缀为个人姓名缩写，例：<code>pc/feature/210330_v4.4.0_[功能名称]_[姓名缩写]</code> (4.4.0版本xx功能，xx开发分支)。功能分支不需要多人协作时，不创建个人分支，直接在功能分支上开发</li>
<li>发包：需求开发或测试过程中，将打包后的h5包上传到 对应 环境</li>
<li>发版：单指将打包后的h5包上传到 <code>生产</code> 环境</li>
<li>提测：该期迭代所有需求开发完成，在版本分支打包并发包至 <code>测试</code> 环境交由测试</li>
<li>封版：需求开发完成并测试结束，产品宣布通过验收，该版本分支即成为封版分支，不再合并任何代码</li>
<li>指向：需求开发完成并封版，产品宣布将最后一次 <code>生产</code> 环境测试的包提供给用户使用<h3 id="分支说明"><a href="#分支说明" class="headerlink" title="分支说明"></a>分支说明</h3>在原有分支的基础上增加了<code>master</code>分支用来对应线上指向版本，原<code>dev</code>分支作为稳定分支，对应最新封版版本，移除个人feature开发分支</li>
<li><code>master</code> (线上分支，对应线上指向版本)</li>
<li><code>hotfix</code> (线上问题修复分支，实时基于<code>master</code>创建)<ul>
<li><code>hotfix</code>分支用于修改线上紧急bug，需要时基于当前<code>master</code>分支实时创建，在<code>hotfix</code>上修改并测试通过后，合并到<code>master</code>，并删除该<code>hotfix</code></li>
</ul>
</li>
<li><code>dev</code> (稳定分支，对应当前最新封版版本)<ul>
<li>因当前项目存在封版但不指向的现象，故将dev分支作为稳定分支实时对应当前最新封版版本</li>
</ul>
</li>
<li><code>feature</code> (<code>feature</code>是一个概念，包含所有基于该期迭代创建的分支)<ul>
<li><code>版本feature</code>（即该期迭代版本分支，基于此分支创建的功能分支开发的功能最终都要合并到此分支上，该分支会在封版后合并到 <code>dev</code> 并隐藏）<ul>
<li>当前版本的走查、补充、测试和bug修复均在此分支进行</li>
</ul>
</li>
<li><code>功能feature</code>（基于当前版本分支创建，根据具体需求数量可以创建多个，功能分支在开发到一定进度或开发完成时要以 <code>pr</code> 的形式合并到版本分支上，版本分支提测后，删除所有该期功能分支）</li>
<li><code>个人feature</code> (功能分支需要多人协作时才可创建，个人分支在开发到一定进度或开发完成时要以 <code>pr</code> 的形式合并到功能分支上，远端个人分支即合即删)<h3 id="工作流程说明"><a href="#工作流程说明" class="headerlink" title="工作流程说明"></a>工作流程说明</h3>该流程模拟了一次完整的迭代开发所需要进行的git流操作</li>
</ul>
</li>
</ul>
<ol>
<li>需求宣讲会结束，明确功能点为 A, B, 产品给出当期迭代版本号 v6.6.6, 迭代开始时间为 2021/6/6</li>
<li>版本负责人基于当前 <code>dev</code> 分支创建版本分支，即 <code>pc/feature/210606_v6.6.6</code></li>
<li>版本负责人基于版本分支 <code>pc/feature/210606_v6.6.6</code> 创建功能分支，即 <code>pc/feature/210606_v6.6.6_A</code> 和 <code>pc/feature/210606_v6.6.6_B</code></li>
<li>功能开发人员基于功能分支开始开发功能</li>
<li>功能开发完毕，各功能开发人员基于自己的功能分支发起 <code>pr</code> 至版本分支 <code>pc/feature/210606_v6.6.6</code></li>
<li><code>pr</code> 合并完毕，版本负责人基于版本分支打包，并发包至 <code>测试</code> 环境，开始提测。提测后删除远端所有该版本分支下的功能分支</li>
<li>测试过程中，各开发人员基于版本分支创建自己的bug修复分支,（暂定 <code>fixbug_v6.6.6_[姓名缩写]</code>）,bug修改也以<code>pr</code>的方式提交到版本分支，远端bug修复分支即合即删</li>
<li>测试完成，产品宣布验收通过可以封版，版本负责人将该版本分支合并到<code>dev</code>分支，并将远端该版本分支隐藏</li>
<li>如产品宣布该版本指向给客户，组长将<code>dev</code>分支合并到<code>master</code>分支<h3 id="异常流程处理"><a href="#异常流程处理" class="headerlink" title="异常流程处理"></a>异常流程处理</h3>以下为可能遇到的异常流程处理方案，如有不足可补充</li>
<li>指向版本出现bug<ul>
<li>需要紧急修复，基于当前<code>master</code>分支创建<code>hotfix</code>分支，在<code>hotfix</code>上修改bug并交由测试通过，将<code>hotfix</code>分支合并到<code>master</code>并基于<code>master</code>打包发版，然后删除该<code>hotfix</code>。操作完成后需在钉钉群里@所有人，说明改动情况，进行信息同步</li>
<li>不需要紧急修复，找到下一个进行中的版本分支创建<code>coldfix</code>分支，在<code>coldfix</code>上修改bug并自测通过，在<code>coldfix</code>发起<code>pr</code>到对应版本分支，通知版本负责人审合<code>pr</code>后，删除该<code>coldfix</code>。版本负责人要在提测时通知测试该bug修复情况</li>
</ul>
</li>
</ol>
<h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><ol>
<li>为了避免单次<code>pr</code>包含的代码量过大导致难以审核，各功能开发人员需要在开发达到一定节点后就主动发起，可以少量多次</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/08/05/%E4%BB%A3%E7%A0%81%E8%A7%84%E8%8C%83%EF%BC%9A%E5%8F%98%E9%87%8F%E5%91%BD%E5%90%8D/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="chenleno">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="chenleno's">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/08/05/%E4%BB%A3%E7%A0%81%E8%A7%84%E8%8C%83%EF%BC%9A%E5%8F%98%E9%87%8F%E5%91%BD%E5%90%8D/" itemprop="url">代码规范：变量命名</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-08-05T17:56:14+08:00">
                2020-08-05
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="变量命名规范"><a href="#变量命名规范" class="headerlink" title="变量命名规范"></a>变量命名规范</h1><p>项目中目前存在变量命名模糊，不规范的问题，实际开发时会带来一些困扰。此版为初版变量命名方案，有想法的欢迎提交修改。</p>
<h2 id="常量命名"><a href="#常量命名" class="headerlink" title="常量命名"></a>常量命名</h2><p>与变量相对的是常量，项目中目前存在很多的常量如：<code>host</code>, <code>pageSize</code>等。为了能在开发时能直观的区分变量和常量，推荐使用 <code>大写单词</code> + <code>_</code> 命名常量。例：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> HOST = <span class="string">'www.global.com'</span></span><br><span class="line"><span class="keyword">const</span> FILE_TYPE_LIST = [<span class="string">'mp3'</span>, <span class="string">'mp4'</span>, <span class="string">'jpg'</span>]</span><br><span class="line"><span class="keyword">const</span> PAGE_SIZE = <span class="number">20</span></span><br></pre></td></tr></table></figure>
<h2 id="变量命名思想"><a href="#变量命名思想" class="headerlink" title="变量命名思想"></a>变量命名思想</h2><p>变量命名采用驼峰命名，变量命名的理想情况是：变量名能直观的反应数据类型，并且可以一定程度上反应该变量对应的业务逻辑。如：<code>upStageStudentList</code> (上台的学生列表，数组类型)。因此，只要能够合理的反映变量作用和类型，一定程度上的长变量名也是可以接受的。</p>
<h3 id="对象"><a href="#对象" class="headerlink" title="对象"></a>对象</h3><p>单数名词，如：<code>file</code>, <code>user</code>, <code>room</code>等，如存在命名冲突问题，可用 <code>fileInfo</code>, <code>fileObj</code> 等替代</p>
<h3 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h3><p>一般由 名词 + <code>List</code> 组成，如：<code>userList</code>, <code>fileList</code>, 也可使用 <code>userArr</code>等表明变量属性的组合词或者 <code>users</code> 复数名词</p>
<h3 id="布尔值"><a href="#布尔值" class="headerlink" title="布尔值"></a>布尔值</h3><p>表 <code>true</code> 的单词一般由 <code>is</code> + <code>业务单词</code> 组成，如：<code>isOpen</code>, <code>isStudent</code>。</p>
<p>表 <code>false</code> 的单词一般由 <code>not</code> + <code>业务单词</code> 组成，如：<code>notOpen</code>, <code>notStudent</code>。</p>
<h3 id="hashMap"><a href="#hashMap" class="headerlink" title="hashMap"></a>hashMap</h3><p><code>hashMap</code>表示一个对象集合，集合中对象的<code>key</code>为<code>业务key</code>, <code>value</code>为对应的<code>集合对象</code>。<br>因此 <code>hashMap</code> 在命名时可以通过 <code>集合名词</code> + <code>By</code> + <code>key</code> 来命名。如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> userListById = &#123;</span><br><span class="line">  <span class="string">'qwe'</span>: &#123;<span class="attr">id</span>: <span class="string">'qwe'</span>, <span class="attr">name</span>: <span class="string">'哈哈'</span>&#125;,</span><br><span class="line">  <span class="string">'asd'</span>: &#123;<span class="attr">id</span>: <span class="string">'asd'</span>, <span class="attr">name</span>: <span class="string">'嘻嘻'</span>&#125;,</span><br><span class="line">  <span class="string">'zxc'</span>: &#123;<span class="attr">id</span>: <span class="string">'zxc'</span>, <span class="attr">name</span>: <span class="string">'呵呵'</span>&#125;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> userListByName = &#123;</span><br><span class="line">  <span class="string">'哈哈'</span>: &#123;<span class="attr">id</span>: <span class="string">'qwe'</span>, <span class="attr">name</span>: <span class="string">'哈哈'</span>&#125;,</span><br><span class="line">  <span class="string">'嘻嘻'</span>: &#123;<span class="attr">id</span>: <span class="string">'asd'</span>, <span class="attr">name</span>: <span class="string">'嘻嘻'</span>&#125;,</span><br><span class="line">  <span class="string">'呵呵'</span>: &#123;<span class="attr">id</span>: <span class="string">'zxc'</span>, <span class="attr">name</span>: <span class="string">'呵呵'</span>&#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="文件命名"><a href="#文件命名" class="headerlink" title="文件命名"></a>文件命名</h3><p>文件名称建议和文件内部的组件名或者service名称保持一致。在React中，组件均使用 <code>.jsx</code> 后缀，service类型使用 <code>.js</code> 后缀。</p>
<p>补充：<br><code>lodash</code>中有很方便的将 <code>数组</code> 转化为 <code>hashMap</code> 的方法 <code>keyBy</code>, 使用方法为: <code>_.keyBy(arr, key)</code>, 返回值为对应key的 <code>hashMap</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> _ <span class="keyword">from</span> <span class="string">'lodash'</span></span><br><span class="line"><span class="keyword">const</span> userList = [</span><br><span class="line">  &#123;<span class="attr">id</span>: <span class="string">'qwe'</span>, <span class="attr">name</span>: <span class="string">'哈哈'</span>&#125;,</span><br><span class="line">  &#123;<span class="attr">id</span>: <span class="string">'asd'</span>, <span class="attr">name</span>: <span class="string">'嘻嘻'</span>&#125;,</span><br><span class="line">  &#123;<span class="attr">id</span>: <span class="string">'zxc'</span>, <span class="attr">name</span>: <span class="string">'呵呵'</span>&#125;</span><br><span class="line">]</span><br><span class="line"><span class="keyword">const</span> userListById = _.keyBy(userList, <span class="string">'id'</span>)</span><br><span class="line"><span class="comment">// userListById: &#123;</span></span><br><span class="line"><span class="comment">//   'qwe': &#123;id: 'qwe', name: '哈哈'&#125;,</span></span><br><span class="line"><span class="comment">//   'asd': &#123;id: 'asd', name: '嘻嘻'&#125;,</span></span><br><span class="line"><span class="comment">//   'zxc': &#123;id: 'zxc', name: '呵呵'&#125;,</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/08/05/%E4%BB%A3%E7%A0%81%E8%A7%84%E8%8C%83%EF%BC%9A%E6%9D%A1%E4%BB%B6%E5%88%A4%E6%96%AD/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="chenleno">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="chenleno's">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/08/05/%E4%BB%A3%E7%A0%81%E8%A7%84%E8%8C%83%EF%BC%9A%E6%9D%A1%E4%BB%B6%E5%88%A4%E6%96%AD/" itemprop="url">代码规范：条件判断</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-08-05T17:59:54+08:00">
                2020-08-05
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="条件判断编写优化规范"><a href="#条件判断编写优化规范" class="headerlink" title="条件判断编写优化规范"></a>条件判断编写优化规范</h1><p>项目中目前充斥着各种和业务耦合的判断逻辑，随着功能的不断迭代，判断逻辑会变得越来越长，可读性变差的同时也难以维护。</p>
<h2 id="优化思想"><a href="#优化思想" class="headerlink" title="优化思想"></a>优化思想</h2><ul>
<li>判断符合直觉</li>
<li>长拆短</li>
<li>类型归类</li>
<li>和业务解耦</li>
<li>合理应用三目</li>
<li>合理应用<code>if</code></li>
<li>逻辑修改添加注释<h3 id="判断符合直觉"><a href="#判断符合直觉" class="headerlink" title="判断符合直觉"></a>判断符合直觉</h3>逻辑判断的编写应符合直觉，判断条件为<code>true</code>则相应逻辑也是<code>true</code>的对应逻辑。不要编写反直觉条件。<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!b) &#123; ... 则 a ... &#125; <span class="comment">// bad</span></span><br><span class="line"><span class="keyword">if</span> (a) &#123; ...则 a ... &#125;   <span class="comment">// good</span></span><br></pre></td></tr></table></figure>
<h3 id="长拆短"><a href="#长拆短" class="headerlink" title="长拆短"></a>长拆短</h3>如果遇到或者编写出了很长的判断条件，应该思考将长判断条件分类，根据业务或身份或条件类型拆分成几个短条件，最后再合并<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( a &amp;&amp; (a === b || a === c) || ( b &amp;&amp; b === d))    <span class="comment">// bad</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> isA = a &amp;&amp; (a === b || a === c)</span><br><span class="line"><span class="keyword">const</span> isB = b &amp;&amp; b === d</span><br><span class="line"><span class="keyword">if</span> ( isA || isB)                                      <span class="comment">// good</span></span><br></pre></td></tr></table></figure>
<h3 id="类型归类"><a href="#类型归类" class="headerlink" title="类型归类"></a>类型归类</h3>通常用于一个判断条件中即包含 <code>&amp;&amp;</code> 也包含 <code>||</code>，当条件处于并列关系时，可以考虑基于其中一种进行拆分，将相同类型归类放置，如：<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">if</span> (a &amp;&amp; b || c &amp;&amp; d || e) <span class="comment">// bad</span></span><br><span class="line">  <span class="keyword">if</span> (a &amp;&amp; b &amp;&amp; d || c || e) <span class="comment">// good</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> foo = a &amp;&amp; b &amp;&amp; d</span><br><span class="line">  <span class="keyword">if</span> (foo || c || e)         <span class="comment">// better</span></span><br><span class="line"><span class="string">``</span><span class="string">` </span></span><br><span class="line"><span class="string">### 业务解耦</span></span><br><span class="line"><span class="string">长判断一般都是随着项目迭代，需求更改而累加上去的，其中耦合了业务。因此在拆分时可以通过分析具体业务逻辑，进行部分条件的业务解耦并抽取成公共部分，如身份，权限判断等。</span></span><br><span class="line"><span class="string">`</span><span class="string">``</span>javascript</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ((a &amp;&amp; a === b || c) &#123; ... &#125;</span><br><span class="line">    <span class="keyword">if</span> ((a &amp;&amp; a === b || d || e)) &#123; ... &#125; </span><br><span class="line">  &#125; <span class="comment">// bad</span></span><br><span class="line"></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">const</span> isA = a &amp;&amp; a === b</span><br><span class="line">    <span class="keyword">if</span> (isA || c) &#123; ... &#125;</span><br><span class="line">    <span class="keyword">if</span> (isA || d || e) &#123; ... &#125;</span><br><span class="line">  &#125; <span class="comment">// good</span></span><br></pre></td></tr></table></figure>
<h3 id="合理应用三目"><a href="#合理应用三目" class="headerlink" title="合理应用三目"></a>合理应用三目</h3>三目运算符是很方便的条件判断逻辑，但是如果运用不得当也会导致多重条件嵌套，难以阅读的问题。<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">a === b ? ( a === c ? <span class="literal">true</span> : <span class="literal">false</span> ) : <span class="literal">false</span>      <span class="comment">// bad</span></span><br><span class="line">(a === b &amp;&amp; a === c) ? <span class="literal">true</span> : <span class="literal">false</span>               <span class="comment">// bad</span></span><br><span class="line"><span class="keyword">if</span> (a === b &amp;&amp; a === c)                           <span class="comment">// good</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> arr = [b, c]</span><br><span class="line"><span class="keyword">if</span> (arr.includes(a))                              <span class="comment">// better</span></span><br></pre></td></tr></table></figure>
<h3 id="合理应用if"><a href="#合理应用if" class="headerlink" title="合理应用if"></a>合理应用if</h3>使用 <code>if</code> 应当注意单一功能原则（即一个 <code>if</code> 语句只做一件事), 避免 <code>if</code> 嵌套<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">let</span> a</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> (b === <span class="number">0</span>) &#123;</span><br><span class="line">      a = b</span><br><span class="line">      <span class="keyword">if</span> (c === <span class="number">1</span>) &#123;</span><br><span class="line">        a = c</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="comment">// bad</span></span><br><span class="line">  </span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> (b === <span class="number">0</span>) a = b</span><br><span class="line">    <span class="keyword">if</span> (c === <span class="number">1</span>) a = c</span><br><span class="line">  &#125; <span class="comment">// good</span></span><br><span class="line"><span class="string">``</span><span class="string">` </span></span><br><span class="line"><span class="string">### 逻辑修改添加注释</span></span><br><span class="line"><span class="string">开发过程中难免遇到需求更改导致的条件判断修改，因此为修改的逻辑添加注释就显得尤为重要。方便溯源的同时也方便他人阅读。</span></span><br><span class="line"><span class="string">`</span><span class="string">``</span>javascript</span><br><span class="line">  <span class="keyword">if</span> (a === b) </span><br><span class="line"></span><br><span class="line">  <span class="comment">// 如果用户身份不是学生的情况下才发送</span></span><br><span class="line">  <span class="keyword">if</span> (a !== <span class="number">2</span> &amp;&amp; a === b)</span><br></pre></td></tr></table></figure>
<h3 id="举例"><a href="#举例" class="headerlink" title="举例"></a>举例</h3>如下是一个项目中存在的判断条件</li>
</ul>
<p>该判断条件可读性很差，不仅充斥着各种条件判断，还将老师的逻辑和学生的逻辑糅合在了一起，难以修改并且存在bug</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ((ServiceRoom.getTkRoom().getMySelf().id === fromID || (fromID == <span class="string">'__TKServer'</span> &amp;&amp; !TkGlobal.classBegin))&amp;&amp;!TkConstant.hasRole.roleStudent || (!TkGlobal.classBegin &amp;&amp; TkConstant.hasRole.roleStudent &amp;&amp; fromID == <span class="string">'__TKServer'</span>)) &#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们可以利用以上优化思想进行逻辑拆分，优化我们的判断条件</p>
<p>通过抽出公共逻辑，归类身份逻辑，分别列出老师的判断逻辑和学生的判断逻辑，分别写出不同身份对应的业务逻辑判断。这样后期如果要修改的话可以很快定位，也不会有身份混乱的问题。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> isMySelf = ServiceRoom.getTkRoom().getMySelf().id === fromID || fromID === <span class="string">'__TKServer'</span></span><br><span class="line"><span class="comment">// 老师的课件添加事件响应逻辑,不管上下课,是自己添加的就打开</span></span><br><span class="line"><span class="keyword">const</span> teacherCtrl = !TkConstant.hasRole.roleStudent &amp;&amp; isMySelf</span><br><span class="line"><span class="comment">// 学生的课件添加事件响应逻辑, 学生课前扫码上传，不同步</span></span><br><span class="line"><span class="keyword">const</span> studentCtrl = !TkGlobal.classBegin &amp;&amp; TkConstant.hasRole.roleStudent &amp;&amp; isMySelf</span><br><span class="line"><span class="keyword">if</span> (teacherCtrl || studentCtrl) &#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/05/26/%E5%B7%A5%E4%BD%9C%E7%AC%94%E8%AE%B0%E4%B9%8B%E7%9B%B4%E6%92%AD%E6%B5%81%E7%9B%B8%E5%85%B3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="chenleno">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="chenleno's">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/05/26/%E5%B7%A5%E4%BD%9C%E7%AC%94%E8%AE%B0%E4%B9%8B%E7%9B%B4%E6%92%AD%E6%B5%81%E7%9B%B8%E5%85%B3/" itemprop="url">工作笔记之流媒体相关</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-05-26T23:46:47+08:00">
                2020-05-26
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%B7%A5%E4%BD%9C%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index">
                    <span itemprop="name">工作笔记</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="工作笔记之流媒体相关"><a href="#工作笔记之流媒体相关" class="headerlink" title="工作笔记之流媒体相关"></a>工作笔记之流媒体相关</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>来到新东家的头个任务是实现一个pc，手机浏览器都能观看的直播项目。截止目前暂且告一段落，了解到了许多不曾接触过的流媒体相关的内容，特此一记。</p>
<h2 id="技术栈选型"><a href="#技术栈选型" class="headerlink" title="技术栈选型"></a>技术栈选型</h2><p>当然是天下第一的react了，create-react-app脚手架搭建的基础项目已经足以应付目前的需求。为了方便后期拓展还引入了react-router。未使用ui框架，页面实现是基于css媒体查询的响应式。</p>
<h2 id="直播原理"><a href="#直播原理" class="headerlink" title="直播原理"></a>直播原理</h2><p>受限于目前水平，还无法很好地归纳直播原理，暂时先写一个个人的理解吧，后期随着了解深入还会修改</p>
<blockquote>
<p>简单来说直播就是直播方从推流链接推流，播放方获取拉流链接交给video播放器，当媒体流过来时播放器解析流信息并播放</p>
</blockquote>
<h2 id="流媒体协议"><a href="#流媒体协议" class="headerlink" title="流媒体协议"></a>流媒体协议</h2><h3 id="RTMP"><a href="#RTMP" class="headerlink" title="RTMP"></a>RTMP</h3><h3 id="HDL"><a href="#HDL" class="headerlink" title="HDL"></a>HDL</h3><p>移动端和safari不支持该协议,适用于pc端，优点是延迟较低<br>请求的是.flv文件,</p>
<h3 id="HLS"><a href="#HLS" class="headerlink" title="HLS"></a>HLS</h3><p>pc和移动端均支持该协议，延迟较高<br>HLS协议会请求.m3u8文件，这个文件内包含有直播流的分片信息 .ts, 播放器再去请求这些分片信息资源实现播放</p>
<h2 id="盗链和防盗链"><a href="#盗链和防盗链" class="headerlink" title="盗链和防盗链"></a>盗链和防盗链</h2><h2 id="小技巧"><a href="#小技巧" class="headerlink" title="小技巧"></a>小技巧</h2><h3 id="一元运算符"><a href="#一元运算符" class="headerlink" title="+ 一元运算符"></a>+ 一元运算符</h3><p><code>+new Date()</code> 等效于 <code>new Date().getTime()</code>,都是获取时间戳</p>
<h2 id="safari浏览器调试踩坑"><a href="#safari浏览器调试踩坑" class="headerlink" title="safari浏览器调试踩坑"></a>safari浏览器调试踩坑</h2><h3 id="操作符编译失败"><a href="#操作符编译失败" class="headerlink" title="...操作符编译失败"></a><code>...</code>操作符编译失败</h3><p>或许是我的babel-polyfill没有配置好…<br>使用了<code>Object.assign()</code>暂时替代</p>
<h3 id="正则表达式不支持后发断言"><a href="#正则表达式不支持后发断言" class="headerlink" title="正则表达式不支持后发断言"></a>正则表达式不支持后发断言</h3><p>我想在获取的url里更新<code>timeStamp=123456</code>中的数字部分，使用正则后发断言在safari中会报错</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'timeStamp=123456'</span>.replace(<span class="regexp">/(?&lt;=timeStamp=)[\d]*/g</span>, +<span class="keyword">new</span> <span class="built_in">Date</span>()) <span class="comment">// safari报错</span></span><br><span class="line"><span class="comment">// 替换方案 ===&gt; </span></span><br><span class="line"><span class="string">'timeStamp=123456'</span>.replace(<span class="regexp">/timeStamp=[\d]*/g</span>, <span class="string">'timeStamp='</span> + +<span class="keyword">new</span> <span class="built_in">Date</span>()) <span class="comment">// low了点</span></span><br></pre></td></tr></table></figure>
<h3 id="new-Date-format-format不支持-YYYY-MM-DD-格式"><a href="#new-Date-format-format不支持-YYYY-MM-DD-格式" class="headerlink" title="new Date(format) format不支持 YYYY-MM-DD 格式"></a>new Date(format) format不支持 YYYY-MM-DD 格式</h3><p>safari中使用 <code>+new Date(&#39;2020-05-17 22:13:15&#39;)</code>时不会返回预期时间戳，会返回<code>Invalid Date</code><br>解决方法是将日期中的<code>-</code>替换成<code>/</code><br><code>+new Date(&#39;2020-05-17 22:13:15&#39;.replace(/\-/g, &#39;/&#39;))</code></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/05/12/%E4%BB%A3%E7%A0%81pr%E5%AE%A1%E6%A0%B8%E6%B5%81%E7%A8%8B%E8%AF%B4%E6%98%8E/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="chenleno">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="chenleno's">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/05/12/%E4%BB%A3%E7%A0%81pr%E5%AE%A1%E6%A0%B8%E6%B5%81%E7%A8%8B%E8%AF%B4%E6%98%8E/" itemprop="url">代码pr审核流程说明</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-05-12T22:21:09+08:00">
                2020-05-12
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%B7%A5%E4%BD%9C%E6%B5%81/" itemprop="url" rel="index">
                    <span itemprop="name">工作流</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="代码pr审核流程说明"><a href="#代码pr审核流程说明" class="headerlink" title="代码pr审核流程说明"></a>代码pr审核流程说明</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>pr (pull request)或称 mr（merge request）是一种git代码合并工作流程。意即将分支代码合并过程放在远端，藉由提交者发起pr的形式，由协作者共同进行代码评审，评审通过后由合并者在远端进行分支合并操作的流程。</p>
<h2 id="优缺点"><a href="#优缺点" class="headerlink" title="优缺点"></a>优缺点</h2><p>优点：</p>
<ul>
<li>代码变动和更新公开透明，规避了本地合并提交的黑盒操作</li>
<li>代码合并质量有保障，每个协作者都可以查看提交内容并给出建议</li>
<li>提高开发者的代码优化意识，对每次提交保持敬畏之心</li>
</ul>
<p>缺点：</p>
<ul>
<li>涉及多人评审时会略微占用开发时间，影响工作节奏<h2 id="提交，审核及合并规范"><a href="#提交，审核及合并规范" class="headerlink" title="提交，审核及合并规范"></a>提交，审核及合并规范</h2></li>
<li>pr审核至少要有两人参与（发起者和一名协作者）</li>
<li>原则上pr发起者<strong>不能</strong><code>Merge</code>自己的pr，特殊情况下除外，但也需要通知其他协作者并得到同意</li>
<li>所有pr提交均需要通知到所有相关协作者并视情况同步本地代码</li>
</ul>
<p>Tips: git 暂存操作 git stash</p>
<h2 id="操作流程"><a href="#操作流程" class="headerlink" title="操作流程"></a>操作流程</h2><p>以gitlab为例，进行一次完整的模拟pr提交过程</p>
<h3 id="clone远端仓库"><a href="#clone远端仓库" class="headerlink" title="clone远端仓库"></a>clone远端仓库</h3><blockquote>
<p>$ git clone git@origin/pr-example.git</p>
</blockquote>
<p>假定项目主分支为 <strong>master</strong> 分支</p>
<h3 id="建立本地个人开发分支"><a href="#建立本地个人开发分支" class="headerlink" title="建立本地个人开发分支"></a>建立本地个人开发分支</h3><p>pr提交要求每个开发者都有基于主分支的个人开发分支，开发者在个人开发分支开发功能需求</p>
<blockquote>
<p>$ git checkout -b private_dev(开发分支名自取)</p>
</blockquote>
<h3 id="在个人分支开发功能需求"><a href="#在个人分支开发功能需求" class="headerlink" title="在个人分支开发功能需求"></a>在个人分支开发功能需求</h3><p>some coding…</p>
<blockquote>
<p>$ git add .</p>
</blockquote>
<blockquote>
<p>$ git commit -m ‘feat: something new’</p>
</blockquote>
<h3 id="推送本地个人开发分支至远端"><a href="#推送本地个人开发分支至远端" class="headerlink" title="推送本地个人开发分支至远端"></a>推送本地个人开发分支至远端</h3><blockquote>
<p>$ git push</p>
</blockquote>
<p>如果是第一次提交分支到远端git会有提示<br><a href="https://imgchr.com/i/YUYUud" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2020/05/12/YUYUud.md.jpg" alt="YUYUud.md.jpg"></a><br>照做即可</p>
<blockquote>
<p>$ git push –set-upstream origin private_dev</p>
</blockquote>
<h3 id="查看远端仓库个人分支"><a href="#查看远端仓库个人分支" class="headerlink" title="查看远端仓库个人分支"></a>查看远端仓库个人分支</h3><p>此时可以在远程仓库分支列表中查看到自己刚刚推送的个人分支<br><a href="https://imgchr.com/i/YUtjyQ" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2020/05/12/YUtjyQ.md.jpg" alt="YUtjyQ.md.jpg"></a></p>
<h3 id="发起pr"><a href="#发起pr" class="headerlink" title="发起pr"></a>发起pr</h3><ol>
<li>点击图示按钮<br><a href="https://imgchr.com/i/YUNkSU" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2020/05/12/YUNkSU.md.png" alt="YUNkSU.md.png"></a></li>
<li>选择 Source branch (即提交分支 private_dev) 和 Target branch (即目标分支 master),点击下方按钮<br><a href="https://imgchr.com/i/YUNGOH" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2020/05/12/YUNGOH.md.png" alt="YUNGOH.md.png"></a></li>
<li>检查source和target 分支是否正确，可以在changes中查看当前提交的git diff，作最后走查。确认无误点击按钮提交。<br><a href="https://imgchr.com/i/YUUegS" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2020/05/12/YUUegS.md.png" alt="YUUegS.md.png"></a><h3 id="查看pr"><a href="#查看pr" class="headerlink" title="查看pr"></a>查看pr</h3>提交后的pr会出现在<code>Merge Requests</code>页面中，届时所有项目协作者均可点击该pr查看pr内容<br><a href="https://imgchr.com/i/YUURDH" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2020/05/12/YUURDH.md.png" alt="YUURDH.md.png"></a><h3 id="pr审核"><a href="#pr审核" class="headerlink" title="pr审核"></a>pr审核</h3>pr查看者可以在<code>changes</code>页签中查看完整提交内容和变动项。如果对某块代码持有建议可以通过点击对应行数前的评论图标，在输入框中进行评论。<br><a href="https://imgchr.com/i/YUaSP0" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2020/05/12/YUaSP0.md.png" alt="YUaSP0.md.png"></a><br>评论后的内容会显示在对应代码行数下方供pr发起者参考修改。如无异议则可点击<code>Merge</code>按钮合并pr<br><a href="https://imgchr.com/i/YUanG6" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2020/05/12/YUanG6.md.png" alt="YUanG6.md.png"></a><br>pr合并后可以看到master分支已经应用了该change<br><a href="https://imgchr.com/i/YUaIeJ" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2020/05/12/YUaIeJ.md.png" alt="YUaIeJ.md.png"></a><h3 id="协作者分支同步"><a href="#协作者分支同步" class="headerlink" title="协作者分支同步"></a>协作者分支同步</h3>假设有A,B两个协作者，此时远端仓库的master分支已经包含了A的提交代码，则B需要将他的个人开发分支同远端同步<br>B:<blockquote>
<p>$ git stash (暂存当前未add的代码)（视情况使用）</p>
</blockquote>
</li>
</ol>
<blockquote>
<p>$ git checkout master</p>
</blockquote>
<blockquote>
<p>$ git pull（拉取包含最新change的master分支）</p>
</blockquote>
<blockquote>
<p>$ git checkout b_dev(b的个人开发分支)</p>
</blockquote>
<blockquote>
<p>$ git rebase master（变基操作）</p>
</blockquote>
<blockquote>
<p>$ git stash pop (释放之前暂存的代码)（视情况使用）</p>
</blockquote>
<p>通过将个人分支变基到master上的形式来进行代码merge<br>Tips:</p>
<ol>
<li>如果两人修改了同一文件，则此时会发生代码冲突，B需要在本地解决冲突</li>
<li>参考资料：<a href="https://www.jianshu.com/p/c17472d704a0" target="_blank" rel="noopener">git rebase和git merge</a><br>git merge的commit流：<br><img src="https://upload-images.jianshu.io/upload_images/305877-c4ddfcf679821e2f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp" alt="git merge"><br>git rebase 的 commit 流<br><img src="https://upload-images.jianshu.io/upload_images/305877-467ba180733adca1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp" alt="git rebase"></li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/04/16/%E4%BB%8E%E9%9B%B6%E6%90%AD%E5%BB%BAreact-app/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="chenleno">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="chenleno's">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/04/16/%E4%BB%8E%E9%9B%B6%E6%90%AD%E5%BB%BAreact-app/" itemprop="url">从零搭建react app</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-04-16T15:01:03+08:00">
                2020-04-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web%E5%89%8D%E7%AB%AF/" itemprop="url" rel="index">
                    <span itemprop="name">web前端</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="从零搭建react-app"><a href="#从零搭建react-app" class="headerlink" title="从零搭建react app"></a>从零搭建react app</h1><h2 id="前情提要"><a href="#前情提要" class="headerlink" title="前情提要"></a>前情提要</h2><p>使用react开发项目一年有余，我也从一个react小白成长为了一名react开发者（笑）。期间基本是问题驱动学习，因为要学的太多所以指哪打哪，缺乏一个对react技术栈的系统归纳与总结。所以在疫情期间趁此机会从头搭建了一个基于react全家桶的仿后台管理项目，一套下来，感触多多，行文一篇，聊表初心。</p>
<h2 id="项目简介"><a href="#项目简介" class="headerlink" title="项目简介"></a>项目简介</h2><p>使用React开发的类后台管理app。<br>基于create-react-app脚手架构建项目，渐进引入react-router, react-redux, redux-thunk, antd等。<br>并在后期进行了 <strong>路由懒加载</strong>， <strong>redux懒加载</strong> 的功能实践。后续还会基于需求驱动加入webpack优化相关的内容。<br><a href="https://github.com/chenleno/react-app" target="_blank" rel="noopener">项目github: react-app</a></p>
<h2 id="功能及结构说明"><a href="#功能及结构说明" class="headerlink" title="功能及结构说明"></a>功能及结构说明</h2><p>项目的基本功能包含一个登陆页面，登陆后主页面包含Header,SideBar和Content部分，对应显示 人员信息，侧边栏菜单和内容部分。<br>页面之间的跳转基于react-router,同时在登录后初始化 redux, store可以被任意页面引用。<br>User模块包含一个嵌套路由，用以跳转至用户详情。</p>
<h3 id="结构信息"><a href="#结构信息" class="headerlink" title="结构信息"></a>结构信息</h3><pre><code>|-- index.js              // 项目主入口
|-- App.jsx               // render App
|-- components            // 公共组件
|-- conf                  // 配置目录，存放API等
|-- layout                // 布局
|    |-- Header.jsx       // 头部导航
|    |-- Sidebar.jsx      // 侧边导航
|-- modules               // 业务模块
|    |-- dashbard         // 工作台
|    |-- login            // 登录页
|    |-- setting          // 设置页
|    |-- user             // 人员管理
|    |    |-- detail      // 人员详情
|-- reducers              // redux相关
|-- utils                 // 工具函数
|-- routers.js            // router集合
|-- store.js              // redux store</code></pre><h2 id="搭建流程介绍"><a href="#搭建流程介绍" class="headerlink" title="搭建流程介绍"></a>搭建流程介绍</h2><h3 id="基础搭建"><a href="#基础搭建" class="headerlink" title="基础搭建"></a>基础搭建</h3><p>基础搭建部分可以参考官网实例和相关资料，如：<br><a href="https://segmentfault.com/a/1190000015301231" target="_blank" rel="noopener">通过create-react-app 从零搭建react环境</a></p>
<ol>
<li>安装 create-react-app 脚手架，按官网实例操作即可。</li>
<li>尝试引入antd<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ yarn add antd</span><br><span class="line"><span class="comment">// app.jsx</span></span><br><span class="line"><span class="keyword">import</span> &#123; Button &#125; <span class="keyword">from</span> <span class="string">'antd'</span></span><br><span class="line">&lt;Button /&gt;...</span><br></pre></td></tr></table></figure>
此时发现了问题，引入的antd组件样式没有生效。<br>解决： </li>
</ol>
<ul>
<li>运行 npm run eject 命令，分离配置文件</li>
<li>安装 babel-plugin-import （一个用于按需加载组件代码和样式的 babel 插件）</li>
<li>修改package.json,添加如下代码<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123; ...,</span><br><span class="line">  <span class="string">"babel"</span>: &#123;</span><br><span class="line">    <span class="string">"presets"</span>: [</span><br><span class="line">      <span class="string">"react-app"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">"plugins"</span>: [</span><br><span class="line">      [<span class="string">"import"</span>, &#123; <span class="string">"libraryName"</span>: <span class="string">"antd"</span>, <span class="string">"libraryDirectory"</span>: <span class="string">"es"</span>, <span class="string">"style"</span>: <span class="string">"css"</span> &#125;]</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
现在就可以看到正常样式的antd组件了<h3 id="引入react-router"><a href="#引入react-router" class="headerlink" title="引入react-router"></a>引入react-router</h3><a href="https://reacttraining.com/react-router/web/example/basic" target="_blank" rel="noopener">react-router 4.x文档</a><br>安装新版react-router及react-router-dom<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add react-router react-router-dom</span><br></pre></td></tr></table></figure>
项目安装的react-router是最新的5.x 版本，react-router 4x版本上下使用时有较大区别，主要体现在：</li>
<li>旧版本的Router组件集成在react-router中，新版本则要导入 react-router-dom, 并且 组件还分为 <code>&lt;Browserrouter/&gt;</code>, <code>&lt;NativeRouter/&gt;</code>等.<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 3.x</span></span><br><span class="line"><span class="keyword">import</span> &#123; Router &#125; <span class="keyword">from</span> <span class="string">'react-router'</span></span><br><span class="line">&lt;Router&gt;...&lt;<span class="regexp">/Router&gt;</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ 4.x</span></span><br><span class="line"><span class="regexp">import &#123; BrowserRouter, Route &#125; from 'react-router-dom'</span></span><br><span class="line"><span class="regexp">&lt;BrowserRouter&gt;...&lt;/</span>BrowserRouter&gt;</span><br></pre></td></tr></table></figure></li>
<li>新版本react-router 采用<strong>组件化</strong>的方式设置路由，路由组件<Route/>就像react组件一样包裹在外层就可以</li>
</ul>
<ol>
<li>首先在App最外层外包BrowserRouter<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; BrowserRouter &#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">'./App'</span></span><br><span class="line"></span><br><span class="line">ReactDOM.render(</span><br><span class="line">  &lt;BrowserRouter&gt;</span><br><span class="line">    &lt;Route path=&#123;<span class="string">'/'</span>&#125; component=&#123;App&#125;/&gt;</span><br><span class="line">  &lt;<span class="regexp">/BrowserRouter&gt;</span></span><br><span class="line"><span class="regexp">, </span></span><br><span class="line"><span class="regexp">document.getElementById('root'));</span></span><br></pre></td></tr></table></figure></li>
<li>然后在App中注册路由及组件<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// App.jsx</span></span><br><span class="line"><span class="keyword">import</span> &#123; Route, Switch, Redirect &#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">get</span> isLogin() &#123; <span class="comment">// 根据isLogin参数来判断登录状态，isLogin来源于redux和localStorage是否存有登录信息</span></span><br><span class="line">    <span class="keyword">return</span> localStorage.getItem(<span class="string">'profile'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;React.Fragment&gt;</span><br><span class="line">        &#123;<span class="keyword">this</span>.isLogin ?</span><br><span class="line">          &lt;MainView &gt;</span><br><span class="line">            &lt;Header <span class="class"><span class="keyword">class</span>/&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">MainContent</span>&gt;</span></span><br><span class="line"><span class="class">              &lt;<span class="title">SideBar</span> <span class="title">className</span></span>=<span class="string">'sidebar'</span>/&gt;</span><br><span class="line">              &lt;Content&gt;</span><br><span class="line">                &lt;Switch&gt;</span><br><span class="line">                  &#123;<span class="comment">/* &lt;Redirect path=&#123;'/'&#125; to=&#123;'/dashboard'&#125;/&gt; */</span>&#125;</span><br><span class="line">                  &lt;Route path=&#123;<span class="string">'/dashboard'</span>&#125; exact component=&#123;Dashboard&#125;/&gt;</span><br><span class="line">                  &lt;Route path=&#123;<span class="string">'/user'</span>&#125; exact component=&#123;User&#125;/&gt;</span><br><span class="line">                  &lt;Route path=&#123;<span class="string">'*'</span>&#125; component=&#123;NotFoundPage&#125;/&gt;</span><br><span class="line">                &lt;<span class="regexp">/Switch&gt;</span></span><br><span class="line"><span class="regexp">              &lt;/</span>Content&gt;</span><br><span class="line">            &lt;<span class="regexp">/MainContent&gt;</span></span><br><span class="line"><span class="regexp">          &lt;/</span>MainView&gt; </span><br><span class="line">        : </span><br><span class="line">        &lt;React.Fragment&gt;</span><br><span class="line">          &lt;Route path=&#123;<span class="string">'/login'</span>&#125; render=&#123;() =&gt; <span class="xml"><span class="tag">&lt;<span class="name">Login</span> &#123;<span class="attr">...this.props</span>&#125;/&gt;</span></span>&#125;/&gt;</span><br><span class="line">          &lt;Redirect to=&#123;&#123; <span class="attr">pathname</span>: <span class="string">'/login'</span>, <span class="attr">from</span>: <span class="keyword">this</span>.props.location &#125;&#125; /&gt;</span><br><span class="line">        &lt;<span class="regexp">/React.Fragment&gt;</span></span><br><span class="line"><span class="regexp">        &#125;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>React.Fragment&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>在使用层添加跳转逻辑即可<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Sidebar.jsx</span></span><br><span class="line"><span class="keyword">import</span> &#123; useHistory &#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span> </span><br><span class="line"><span class="comment">// 新版react-router使用history替代旧版的router, 提供了hooks，可以用来获取history,params,location等</span></span><br><span class="line">  <span class="keyword">const</span> history = useHistory()</span><br><span class="line">&#123;</span><br><span class="line">  &lt;Menu.Item onClick=&#123;() =&gt; history.push(<span class="string">'/dashboard'</span>)&#125; key=<span class="string">"1"</span>&gt;dashboard&lt;<span class="regexp">/Menu.Item&gt;</span></span><br><span class="line"><span class="regexp">  &lt;Menu.Item onClick=&#123;() =&gt; history.push('/u</span>ser<span class="string">')&#125; key="2"&gt;setting&lt;/Menu.Item&gt;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="引入react-redux"><a href="#引入react-redux" class="headerlink" title="引入react-redux"></a>引入react-redux</h3><a href="https://cn.redux.js.org/" target="_blank" rel="noopener">redux文档</a><br>redux是一套数据管理方案，react-redux是该方案同react结合的具体实现。</li>
<li>安装redux, react-redux<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add redux react-redux</span><br></pre></td></tr></table></figure></li>
<li>各模块编写reducer<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// reducers/login.js</span></span><br><span class="line"><span class="keyword">const</span> initState = &#123;</span><br><span class="line">  profile: &#123;&#125;,</span><br><span class="line">  isLogin: <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> reducer = <span class="function">(<span class="params">state = initState, action</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'LOGIN'</span>:</span><br><span class="line">      localStorage.setItem(<span class="string">'profile'</span>, action.data)</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        ...initState,</span><br><span class="line">        profile: action.data,</span><br><span class="line">        isLogin: <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'LOGOUT'</span>:</span><br><span class="line">      localStorage.clear()</span><br><span class="line">      <span class="keyword">return</span> initState</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">return</span> initState</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> reducer</span><br><span class="line"><span class="comment">// reducers/index.js</span></span><br><span class="line"><span class="keyword">import</span> login <span class="keyword">from</span> <span class="string">'./login'</span></span><br><span class="line"><span class="keyword">import</span> user <span class="keyword">from</span> <span class="string">'./user'</span></span><br><span class="line"><span class="keyword">import</span> &#123; combineReducers &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span></span><br><span class="line"><span class="keyword">const</span> rootReducers = combineReducers(&#123;</span><br><span class="line">  login,</span><br><span class="line">  user</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> rootReducers</span><br></pre></td></tr></table></figure></li>
<li>创建store文件<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createStore &#125; <span class="keyword">from</span> <span class="string">'redux'</span></span><br><span class="line"><span class="keyword">import</span> rootReducers <span class="keyword">from</span> <span class="string">'./reducers/index'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = createStore(rootReducers)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br></pre></td></tr></table></figure></li>
<li>在App最外层外包store,这样项目便受控于redux<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js </span></span><br><span class="line"><span class="keyword">import</span> &#123; Provider &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">'./store'</span></span><br><span class="line">&lt;Provider store=&#123;store&#125;&gt;</span><br><span class="line">  &lt;BrowserRouter&gt;</span><br><span class="line">    &lt;Route path=&#123;<span class="string">'/'</span>&#125; component=&#123;App&#125;/&gt;</span><br><span class="line">  &lt;<span class="regexp">/BrowserRouter&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>Provider&gt;</span><br></pre></td></tr></table></figure></li>
<li>使用 connect 链接组件与redux<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// login.jsx</span></span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mapStateToProps = <span class="function">(<span class="params">&#123; profile &#125;</span>) =&gt;</span> (&#123; profile &#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> loginData = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Login = <span class="function"><span class="params">props</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; dispatch &#125; = props</span><br><span class="line">  <span class="keyword">const</span> handleClick = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    $axios.post(<span class="string">'/api/xxx'</span>, &#123; <span class="attr">data</span>: loginData &#125;).then(<span class="function"><span class="params">resp</span> =&gt;</span> &#123;</span><br><span class="line">      dispatch(&#123;</span><br><span class="line">        type: <span class="string">'LOGIN'</span>,</span><br><span class="line">        data: resp</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      ...</span><br><span class="line">      &lt;Button onClick=&#123;() =&gt; handleClick()&#125;&gt;登录&lt;<span class="regexp">/Button&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(mapStateToProps)(Login)</span><br></pre></td></tr></table></figure>
实际项目中会将dispatch(action) 进行进一步的抽象<h3 id="引入redux-thunk处理异步action"><a href="#引入redux-thunk处理异步action" class="headerlink" title="引入redux-thunk处理异步action"></a>引入redux-thunk处理异步action</h3><a href="https://zhuanlan.zhihu.com/p/85403048" target="_blank" rel="noopener">redux-thunk使用介绍</a><br>redux模型中，由事件源dispatch一个action,reducer捕获到对应的action之后进行处理，更新redux.state。此处的action必须是一个plain-object。而redux-thunk的作用就是允许我们dispatch一个function,这就给了我们很大的操作空间。</li>
<li>安装redux-thunk<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add redux-thunk</span><br></pre></td></tr></table></figure></li>
<li>store 中使用redux-thunk<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// store.js</span></span><br><span class="line"><span class="keyword">import</span> thunk <span class="keyword">from</span> <span class="string">'redux-thunk'</span></span><br><span class="line"><span class="keyword">import</span> &#123; applyMiddleWare &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="keyword">const</span> store = createStore(rootReducers, </span><br><span class="line"><span class="comment">// redux-thunk是作为redux的中间件使用的</span></span><br><span class="line">  applyMiddleWare(thunk)</span><br><span class="line">)</span><br><span class="line">...</span><br></pre></td></tr></table></figure></li>
<li>编写action，并使用redux-thunk的特性<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// reducers/login.js</span></span><br><span class="line">...</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> login = <span class="function"><span class="params">data</span> =&gt;</span> <span class="function">(<span class="params">dispatch, getState</span>) =&gt;</span> &#123;</span><br><span class="line">  $axios.post(<span class="string">'/api/xxx'</span>, &#123; data &#125;).then(<span class="function"><span class="params">resp</span> =&gt;</span> &#123;</span><br><span class="line">    dispatch(&#123; <span class="attr">type</span>: <span class="string">'LOGIN'</span>, <span class="attr">data</span>: resp &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
这样就可以将异步逻辑封装在action中，上层无感知<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// login.jsx</span></span><br><span class="line"><span class="keyword">import</span> &#123; login &#125; <span class="keyword">from</span> <span class="string">'reducers/login'</span></span><br><span class="line"><span class="keyword">const</span> loginData = &#123;&#125;</span><br><span class="line"><span class="keyword">const</span> Login = <span class="function"><span class="params">props</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; login &#125; = props</span><br><span class="line">  ...</span><br><span class="line">  <span class="keyword">const</span> handleClick = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    login(loginData)</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(mapStateToProps, &#123;</span><br><span class="line">  login</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="项目优化"><a href="#项目优化" class="headerlink" title="项目优化"></a>项目优化</h2><h3 id="编写-httpMiddleWare-进一步封装异步action"><a href="#编写-httpMiddleWare-进一步封装异步action" class="headerlink" title="编写 httpMiddleWare 进一步封装异步action"></a>编写 httpMiddleWare 进一步封装异步action</h3><p>仅适用redux-thunk编写的action还无法满足我们的要求，比如他没有基于promise封装，不能单独拿来接收返回值等。因此我们需要编写一个我们自己的中间件来处理这些事。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 改写后的期望的action范式</span></span><br><span class="line"><span class="comment">// reducers/login.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> login = <span class="function"><span class="params">data</span> =&gt;</span> (&#123;</span><br><span class="line">  type: <span class="string">'LOGIN'</span>,</span><br><span class="line">  promise: <span class="function"><span class="params">client</span> =&gt;</span> client.post(<span class="string">'api/xxx'</span>, &#123; data &#125;),</span><br><span class="line">  args: data</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// login.jsx</span></span><br><span class="line"><span class="keyword">import</span> &#123; login &#125; <span class="keyword">from</span> <span class="string">'reducer/login'</span></span><br><span class="line">&#123;...</span><br><span class="line">  <span class="keyword">const</span> handleLogin = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> resp = <span class="keyword">await</span> <span class="keyword">this</span>.props.login(data) <span class="comment">// 可以接收到异步action的值</span></span><br><span class="line">  &#125;</span><br><span class="line">...&#125;</span><br></pre></td></tr></table></figure>
<p>编写 httpMiddleWare.js 中间件,通讯模块基于axios</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// utils/httpMiddleWare.js</span></span><br><span class="line">  <span class="keyword">import</span> $axios <span class="keyword">from</span> <span class="string">'axios'</span></span><br><span class="line">  <span class="keyword">const</span> httpMiddleWare = <span class="function">(<span class="params">&#123; dispatch, getState &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">next</span> =&gt;</span> <span class="function"><span class="params">action</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (!action) <span class="keyword">return</span> <span class="built_in">Promise</span>.resolve()</span><br><span class="line">      <span class="keyword">const</span> &#123; promise, type, args &#125; = action</span><br><span class="line">      <span class="comment">// promise参数传入的是一个 function </span></span><br><span class="line">      <span class="comment">// promise: client =&gt; client.post('api/xxx')</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> promise !== <span class="string">'function'</span>) <span class="keyword">return</span> next(action)</span><br><span class="line">      <span class="keyword">return</span> promise($axios).then(<span class="function">(<span class="params">&#123; data &#125;</span>) =&gt;</span> &#123; <span class="comment">// promise是函数则把$axios实例传进去构成promise查询</span></span><br><span class="line">        dispatch(&#123; type, data, arg &#125;) <span class="comment">// 接口返回的data对应action.data, 然后触发redux的dispatch(action)</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Promise</span>.resolve(data) <span class="comment">// resolve结果并返回，外界可以直接拿到返回值</span></span><br><span class="line">      &#125;).catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(data) <span class="comment">// 错误reject</span></span><br><span class="line">      &#125;) </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">default</span> httpMiddleWare</span><br><span class="line"><span class="comment">// store.js</span></span><br><span class="line">...</span><br><span class="line"><span class="keyword">import</span> httpMiddleWare <span class="keyword">from</span> <span class="string">'utils/httpMiddleWare'</span></span><br><span class="line"><span class="keyword">const</span> middleWares = [thunk, httpMiddleWare]</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = createStore(rootReducers, </span><br><span class="line">  applyMiddleWare(...middleWares) <span class="comment">// 应用httpMiddleWare中间件</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h3 id="react-router-懒加载模块"><a href="#react-router-懒加载模块" class="headerlink" title="react-router 懒加载模块"></a>react-router 懒加载模块</h3><p><a href="https://blog.whezh.com/react-redux-code-splitting/" target="_blank" rel="noopener">react-router 4.x路由懒加载方案</a><br>react-router 懒加载在 4.x 以前只需要运用 <code>router.getComponent()</code> 方法范式即可，该范式可以在访问到当前路由时才加载路由文件。</p>
<p>在4.x 之后由于取消了<code>router.getComponent()</code>方法，需要借助一个<code>AsyncComponent</code>组件和 webpack的 动态 <code>import()</code> 方法来实现</p>
<ol>
<li>编写一个AsyncComponet wrap组件（也可以直接使用 <a href="https://github.com/jamiebuilds/react-loadable" target="_blank" rel="noopener">react-loadble</a>这个库）<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// component/AsyncComponent.js</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (loader) =&gt; &#123;</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">AsyncComponent</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    state = &#123;</span><br><span class="line">      component: <span class="literal">null</span>,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    componentWillMount() &#123;</span><br><span class="line">      <span class="keyword">if</span> (!<span class="keyword">this</span>.state.component) &#123;</span><br><span class="line">        loader().then(<span class="function"><span class="params">module</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">this</span>.setState(&#123; <span class="attr">component</span>: <span class="built_in">module</span>.default &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render() &#123;</span><br><span class="line">      <span class="keyword">const</span> Comp = <span class="keyword">this</span>.state.component;</span><br><span class="line">      <span class="keyword">return</span> Comp ? <span class="xml"><span class="tag">&lt;<span class="name">Comp</span> &#123;<span class="attr">...this.props</span>&#125; /&gt;</span></span> : <span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>loading<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> AsyncComponent;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>在路由组件导入处包装即可<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// App.jsx</span></span><br><span class="line"><span class="keyword">import</span> AsyncComponent <span class="keyword">from</span> <span class="string">'components/AsyncComponent'</span></span><br><span class="line"><span class="keyword">const</span> Dashboard = AsyncComponent(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'./Dashboard.jsx'</span>))</span><br><span class="line"><span class="keyword">const</span> Login = AsyncComponent(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'./Login.jsx'</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用处不变</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
之后打开控制台查看资源加载情况就可以看见文件是随路由分开加载的了。<br><img src="https://s1.ax1x.com/2020/04/16/JA0LLQ.jpg" alt="文件加载情况"><br>Tips:<br>新版React内部支持<code>React.lazy</code>和<code>Suspense</code>，可以完成同样的事<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; lazy, Suspense &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Dashboard = <span class="xml"><span class="tag">&lt;<span class="name">Suspense</span>&gt;</span>&#123;lazy(() =&gt; import('./Dashboard.jsx'))&#125;<span class="tag">&lt;/<span class="name">Suspense</span>&gt;</span></span></span><br><span class="line"><span class="comment">// 使用处不变</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="react-redux-懒加载redux模块"><a href="#react-redux-懒加载redux模块" class="headerlink" title="react-redux 懒加载redux模块"></a>react-redux 懒加载redux模块</h3>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/">👉</a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">chenleno</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">23</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">7</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">18</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">chenleno</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
